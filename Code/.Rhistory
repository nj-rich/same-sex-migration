col_name <- indv_names[i] #thank you data.frame
df_yeartotals <- df_yeartotals %>%
group_by(YEAR) %>%
mutate(columned = sum(!!sym(col_name), na.rm = T)) %>% #this seems to work oi thanks chatgpt, just missing na.rm = T? why work Mac earlier?
ungroup() %>%
rename(!!total_names[i] := columned)
}
df_yeartotals <- df_yeartotals %>%
select(YEAR, state_name, AL_excluded_total:WY_excluded_total)
#make state year totals
df_statetotals <- df %>%
filter(MIGPLAC1 > 0 & MIGPLAC1 < 57) %>%
group_by(YEAR, state_name) %>%
summarize(state_total = sum(in_samesex_weighted, na.rm = T)) %>%
ungroup()
#some states don't exist here so convert later to 0
#set up division
merged_totals <- df_statetotals %>%
left_join(df_yeartotals, join_by(YEAR, state_name), multiple = "any") #yay get rid of duplicates
samesex_staterate <- merged_totals %>% #oopsy amount of variable names
pivot_wider(names_from = state_name, values_from = state_total) %>%
mutate_all(~replace(., is.na(.), 0)) #coerce missing values to 0
#do the division
for(i in 1:length(state_names)) {
state = state_names[i]
total = total_names[i]
samesex_staterate <- samesex_staterate %>%
mutate(!!state := !!sym(state)/!!sym(total))
}
samesex_staterate <- samesex_staterate %>%
select(YEAR, AK:WY) %>%
pivot_longer(AK:WY, names_to = "state_name") %>%
rename(staterate_year = value) %>%
mutate(staterate_year = staterate_year * 100)
rm(df, merged_totals, df_statetotals, df_yeartotals, col_name, i, indv_names, state, state_names, total, total_names)
gc()
#BACK TO BEGINNING
#ID key variables to merge back in
extra_variables <- df_samesex %>%
distinct(YEAR, state_name, time_since_legalization)
#merge back in - think about implications of extra_variables having extra rows relative to state rate
output <-samesex_staterate %>%
left_join(extra_variables, join_by(YEAR, state_name)) %>%
left_join(FRED, join_by(YEAR, state_name))
#make dummy variables for 1-2, 3-4, 5-6, >7 years (interest results with/without all of this filtering including above)
output <- output %>%
mutate(time_leg_chunked = case_when(
time_since_legalization == 1 ~ 2,
time_since_legalization == 2 ~ 2,
time_since_legalization == 3 ~ 4,
time_since_legalization == 4 ~ 4,
time_since_legalization == 5 ~ 6,
time_since_legalization == 6 ~ 6,
time_since_legalization >= 7 ~ 7,
))
rm(samesex_staterate, extra_variables)
gc()
write.csv(output, "C:\\Users\\njrich\\Desktop\\same-sex-migration\\2019_gen.csv")
write_dta(output, "C:\\Users\\njrich\\Desktop\\same-sex-migration\\2019_gen.dta") #fill in rest by gender
gc()
df <- df_samesex_2019_m
#make year totals excluding each state (no migrant restrictions)
df_yeartotals <- df
state_names <- unique(df$state_name)
indv_names <- paste(state_names, "excluded_indv", sep = "_")
for(i in 1:length(state_names)) {
df_yeartotals <- df_yeartotals %>% #restrict this to gay earlier?
mutate(column = if_else(state_name != state_names[i], in_samesex_weighted, 0)) %>%
rename(!!indv_names[i] := column) #thank you chatgpt
}
gc()
total_names <- paste(state_names, "excluded_total", sep = "_")
for(i in 1:length(state_names)) {
col_name <- indv_names[i] #thank you data.frame
df_yeartotals <- df_yeartotals %>%
group_by(YEAR) %>%
mutate(columned = sum(!!sym(col_name), na.rm = T)) %>% #this seems to work oi thanks chatgpt, just missing na.rm = T? why work Mac earlier?
ungroup() %>%
rename(!!total_names[i] := columned)
}
df_yeartotals <- df_yeartotals %>%
select(YEAR, state_name, AL_excluded_total:WY_excluded_total)
#make state year totals
df_statetotals <- df %>%
filter(MIGPLAC1 > 0 & MIGPLAC1 < 57) %>%
group_by(YEAR, state_name) %>%
summarize(state_total = sum(in_samesex_weighted, na.rm = T)) %>%
ungroup()
#some states don't exist here so convert later to 0
#set up division
merged_totals <- df_statetotals %>%
left_join(df_yeartotals, join_by(YEAR, state_name), multiple = "any") #yay get rid of duplicates
samesex_staterate <- merged_totals %>% #oopsy amount of variable names
pivot_wider(names_from = state_name, values_from = state_total) %>%
mutate_all(~replace(., is.na(.), 0)) #coerce missing values to 0
#do the division
for(i in 1:length(state_names)) {
state = state_names[i]
total = total_names[i]
samesex_staterate <- samesex_staterate %>%
mutate(!!state := !!sym(state)/!!sym(total))
}
samesex_staterate <- samesex_staterate %>%
select(YEAR, AK:WY) %>%
pivot_longer(AK:WY, names_to = "state_name") %>%
rename(staterate_year = value) %>%
mutate(staterate_year = staterate_year * 100)
rm(df, merged_totals, df_statetotals, df_yeartotals, col_name, i, indv_names, state, state_names, total, total_names)
gc()
#BACK TO BEGINNING
#ID key variables to merge back in
extra_variables <- df_samesex %>%
distinct(YEAR, state_name, time_since_legalization)
#merge back in - think about implications of extra_variables having extra rows relative to state rate
output <-samesex_staterate %>%
left_join(extra_variables, join_by(YEAR, state_name)) %>%
left_join(FRED, join_by(YEAR, state_name))
#make dummy variables for 1-2, 3-4, 5-6, >7 years (interest results with/without all of this filtering including above)
output <- output %>%
mutate(time_leg_chunked = case_when(
time_since_legalization == 1 ~ 2,
time_since_legalization == 2 ~ 2,
time_since_legalization == 3 ~ 4,
time_since_legalization == 4 ~ 4,
time_since_legalization == 5 ~ 6,
time_since_legalization == 6 ~ 6,
time_since_legalization >= 7 ~ 7,
))
rm(samesex_staterate, extra_variables)
gc()
write.csv(output, "C:\\Users\\njrich\\Desktop\\same-sex-migration\\2019_m.csv")
write_dta(output, "C:\\Users\\njrich\\Desktop\\same-sex-migration\\2019_m.dta") #fill in rest by gender
gc()
df <- df_samesex_2019_f
#make year totals excluding each state (no migrant restrictions)
df_yeartotals <- df
state_names <- unique(df$state_name)
indv_names <- paste(state_names, "excluded_indv", sep = "_")
for(i in 1:length(state_names)) {
df_yeartotals <- df_yeartotals %>% #restrict this to gay earlier?
mutate(column = if_else(state_name != state_names[i], in_samesex_weighted, 0)) %>%
rename(!!indv_names[i] := column) #thank you chatgpt
}
gc()
total_names <- paste(state_names, "excluded_total", sep = "_")
for(i in 1:length(state_names)) {
col_name <- indv_names[i] #thank you data.frame
df_yeartotals <- df_yeartotals %>%
group_by(YEAR) %>%
mutate(columned = sum(!!sym(col_name), na.rm = T)) %>% #this seems to work oi thanks chatgpt, just missing na.rm = T? why work Mac earlier?
ungroup() %>%
rename(!!total_names[i] := columned)
}
df_yeartotals <- df_yeartotals %>%
select(YEAR, state_name, AL_excluded_total:WY_excluded_total)
#make state year totals
df_statetotals <- df %>%
filter(MIGPLAC1 > 0 & MIGPLAC1 < 57) %>%
group_by(YEAR, state_name) %>%
summarize(state_total = sum(in_samesex_weighted, na.rm = T)) %>%
ungroup()
#some states don't exist here so convert later to 0
#set up division
merged_totals <- df_statetotals %>%
left_join(df_yeartotals, join_by(YEAR, state_name), multiple = "any") #yay get rid of duplicates
samesex_staterate <- merged_totals %>% #oopsy amount of variable names
pivot_wider(names_from = state_name, values_from = state_total) %>%
mutate_all(~replace(., is.na(.), 0)) #coerce missing values to 0
#do the division
for(i in 1:length(state_names)) {
state = state_names[i]
total = total_names[i]
samesex_staterate <- samesex_staterate %>%
mutate(!!state := !!sym(state)/!!sym(total))
}
samesex_staterate <- samesex_staterate %>%
select(YEAR, AK:WY) %>%
pivot_longer(AK:WY, names_to = "state_name") %>%
rename(staterate_year = value) %>%
mutate(staterate_year = staterate_year * 100)
rm(df, merged_totals, df_statetotals, df_yeartotals, col_name, i, indv_names, state, state_names, total, total_names)
gc()
#BACK TO BEGINNING
#ID key variables to merge back in
extra_variables <- df_samesex %>%
distinct(YEAR, state_name, time_since_legalization)
#merge back in - think about implications of extra_variables having extra rows relative to state rate
output <-samesex_staterate %>%
left_join(extra_variables, join_by(YEAR, state_name)) %>%
left_join(FRED, join_by(YEAR, state_name))
#make dummy variables for 1-2, 3-4, 5-6, >7 years (interest results with/without all of this filtering including above)
output <- output %>%
mutate(time_leg_chunked = case_when(
time_since_legalization == 1 ~ 2,
time_since_legalization == 2 ~ 2,
time_since_legalization == 3 ~ 4,
time_since_legalization == 4 ~ 4,
time_since_legalization == 5 ~ 6,
time_since_legalization == 6 ~ 6,
time_since_legalization >= 7 ~ 7,
))
rm(samesex_staterate, extra_variables)
gc()
write.csv(output, "C:\\Users\\njrich\\Desktop\\same-sex-migration\\2019_f.csv")
write_dta(output, "C:\\Users\\njrich\\Desktop\\same-sex-migration\\2019_f.dta") #fill in rest by gender
gc()
df <- df_samesex_inc_1
#make year totals excluding each state (no migrant restrictions)
df_yeartotals <- df
state_names <- unique(df$state_name)
indv_names <- paste(state_names, "excluded_indv", sep = "_")
for(i in 1:length(state_names)) {
df_yeartotals <- df_yeartotals %>% #restrict this to gay earlier?
mutate(column = if_else(state_name != state_names[i], in_samesex_weighted, 0)) %>%
rename(!!indv_names[i] := column) #thank you chatgpt
}
gc()
total_names <- paste(state_names, "excluded_total", sep = "_")
for(i in 1:length(state_names)) {
col_name <- indv_names[i] #thank you data.frame
df_yeartotals <- df_yeartotals %>%
group_by(YEAR) %>%
mutate(columned = sum(!!sym(col_name), na.rm = T)) %>% #this seems to work oi thanks chatgpt, just missing na.rm = T? why work Mac earlier?
ungroup() %>%
rename(!!total_names[i] := columned)
}
df_yeartotals <- df_yeartotals %>%
select(YEAR, state_name, AL_excluded_total:WY_excluded_total)
#make state year totals
df_statetotals <- df %>%
filter(MIGPLAC1 > 0 & MIGPLAC1 < 57) %>%
group_by(YEAR, state_name) %>%
summarize(state_total = sum(in_samesex_weighted, na.rm = T)) %>%
ungroup()
#some states don't exist here so convert later to 0
#set up division
merged_totals <- df_statetotals %>%
left_join(df_yeartotals, join_by(YEAR, state_name), multiple = "any") #yay get rid of duplicates
samesex_staterate <- merged_totals %>% #oopsy amount of variable names
pivot_wider(names_from = state_name, values_from = state_total) %>%
mutate_all(~replace(., is.na(.), 0)) #coerce missing values to 0
#do the division
for(i in 1:length(state_names)) {
state = state_names[i]
total = total_names[i]
samesex_staterate <- samesex_staterate %>%
mutate(!!state := !!sym(state)/!!sym(total))
}
View(samesex_staterate)
gc()
df <- df_samesex_inc_2
#make year totals excluding each state (no migrant restrictions)
df_yeartotals <- df
state_names <- unique(df$state_name)
indv_names <- paste(state_names, "excluded_indv", sep = "_")
for(i in 1:length(state_names)) {
df_yeartotals <- df_yeartotals %>% #restrict this to gay earlier?
mutate(column = if_else(state_name != state_names[i], in_samesex_weighted, 0)) %>%
rename(!!indv_names[i] := column) #thank you chatgpt
}
gc()
total_names <- paste(state_names, "excluded_total", sep = "_")
for(i in 1:length(state_names)) {
col_name <- indv_names[i] #thank you data.frame
df_yeartotals <- df_yeartotals %>%
group_by(YEAR) %>%
mutate(columned = sum(!!sym(col_name), na.rm = T)) %>% #this seems to work oi thanks chatgpt, just missing na.rm = T? why work Mac earlier?
ungroup() %>%
rename(!!total_names[i] := columned)
}
df_yeartotals <- df_yeartotals %>%
select(YEAR, state_name, AL_excluded_total:WY_excluded_total)
#make state year totals
df_statetotals <- df %>%
filter(MIGPLAC1 > 0 & MIGPLAC1 < 57) %>%
group_by(YEAR, state_name) %>%
summarize(state_total = sum(in_samesex_weighted, na.rm = T)) %>%
ungroup()
#some states don't exist here so convert later to 0
#set up division
merged_totals <- df_statetotals %>%
left_join(df_yeartotals, join_by(YEAR, state_name), multiple = "any") #yay get rid of duplicates
samesex_staterate <- merged_totals %>% #oopsy amount of variable names
pivot_wider(names_from = state_name, values_from = state_total) %>%
mutate_all(~replace(., is.na(.), 0)) #coerce missing values to 0
#do the division
for(i in 1:length(state_names)) {
state = state_names[i]
total = total_names[i]
samesex_staterate <- samesex_staterate %>%
mutate(!!state := !!sym(state)/!!sym(total))
}
gc()
df <- df_samesex_st_gen
#make year totals excluding each state (no migrant restrictions)
df_yeartotals <- df
state_names <- unique(df$state_name)
indv_names <- paste(state_names, "excluded_indv", sep = "_")
for(i in 1:length(state_names)) {
df_yeartotals <- df_yeartotals %>% #restrict this to gay earlier?
mutate(column = if_else(state_name != state_names[i], in_samesex_weighted, 0)) %>%
rename(!!indv_names[i] := column) #thank you chatgpt
}
gc()
total_names <- paste(state_names, "excluded_total", sep = "_")
for(i in 1:length(state_names)) {
col_name <- indv_names[i] #thank you data.frame
df_yeartotals <- df_yeartotals %>%
group_by(YEAR) %>%
mutate(columned = sum(!!sym(col_name), na.rm = T)) %>% #this seems to work oi thanks chatgpt, just missing na.rm = T? why work Mac earlier?
ungroup() %>%
rename(!!total_names[i] := columned)
}
df_yeartotals <- df_yeartotals %>%
select(YEAR, state_name, AL_excluded_total:WY_excluded_total)
#make state year totals
df_statetotals <- df %>%
filter(MIGPLAC1 > 0 & MIGPLAC1 < 57) %>%
group_by(YEAR, state_name) %>%
summarize(state_total = sum(in_samesex_weighted, na.rm = T)) %>%
ungroup()
#some states don't exist here so convert later to 0
#set up division
merged_totals <- df_statetotals %>%
left_join(df_yeartotals, join_by(YEAR, state_name), multiple = "any") #yay get rid of duplicates
samesex_staterate <- merged_totals %>% #oopsy amount of variable names
pivot_wider(names_from = state_name, values_from = state_total) %>%
mutate_all(~replace(., is.na(.), 0)) #coerce missing values to 0
#do the division
for(i in 1:length(state_names)) {
state = state_names[i]
total = total_names[i]
samesex_staterate <- samesex_staterate %>%
mutate(!!state := !!sym(state)/!!sym(total))
}
samesex_staterate <- samesex_staterate %>%
select(YEAR, AK:WY) %>%
pivot_longer(AK:WY, names_to = "state_name") %>%
rename(staterate_year = value) %>%
mutate(staterate_year = staterate_year * 100)
rm(df, merged_totals, df_statetotals, df_yeartotals, col_name, i, indv_names, state, state_names, total, total_names)
gc()
#BACK TO BEGINNING
#ID key variables to merge back in
extra_variables <- df_samesex %>%
distinct(YEAR, state_name, time_since_legalization)
#merge back in - think about implications of extra_variables having extra rows relative to state rate
output <-samesex_staterate %>%
left_join(extra_variables, join_by(YEAR, state_name)) %>%
left_join(FRED, join_by(YEAR, state_name))
#make dummy variables for 1-2, 3-4, 5-6, >7 years (interest results with/without all of this filtering including above)
output <- output %>%
mutate(time_leg_chunked = case_when(
time_since_legalization == 1 ~ 2,
time_since_legalization == 2 ~ 2,
time_since_legalization == 3 ~ 4,
time_since_legalization == 4 ~ 4,
time_since_legalization == 5 ~ 6,
time_since_legalization == 6 ~ 6,
time_since_legalization >= 7 ~ 7,
))
rm(samesex_staterate, extra_variables)
gc()
write.csv(output, "C:\\Users\\njrich\\Desktop\\same-sex-migration\\st_gen.csv")
write_dta(output, "C:\\Users\\njrich\\Desktop\\same-sex-migration\\st_gen.dta") #fill in rest by gender
gc()
df <- df_samesex_st_m
#make year totals excluding each state (no migrant restrictions)
df_yeartotals <- df
state_names <- unique(df$state_name)
indv_names <- paste(state_names, "excluded_indv", sep = "_")
for(i in 1:length(state_names)) {
df_yeartotals <- df_yeartotals %>% #restrict this to gay earlier?
mutate(column = if_else(state_name != state_names[i], in_samesex_weighted, 0)) %>%
rename(!!indv_names[i] := column) #thank you chatgpt
}
gc()
total_names <- paste(state_names, "excluded_total", sep = "_")
for(i in 1:length(state_names)) {
col_name <- indv_names[i] #thank you data.frame
df_yeartotals <- df_yeartotals %>%
group_by(YEAR) %>%
mutate(columned = sum(!!sym(col_name), na.rm = T)) %>% #this seems to work oi thanks chatgpt, just missing na.rm = T? why work Mac earlier?
ungroup() %>%
rename(!!total_names[i] := columned)
}
df_yeartotals <- df_yeartotals %>%
select(YEAR, state_name, AL_excluded_total:WY_excluded_total)
#make state year totals
df_statetotals <- df %>%
filter(MIGPLAC1 > 0 & MIGPLAC1 < 57) %>%
group_by(YEAR, state_name) %>%
summarize(state_total = sum(in_samesex_weighted, na.rm = T)) %>%
ungroup()
#some states don't exist here so convert later to 0
#set up division
merged_totals <- df_statetotals %>%
left_join(df_yeartotals, join_by(YEAR, state_name), multiple = "any") #yay get rid of duplicates
samesex_staterate <- merged_totals %>% #oopsy amount of variable names
pivot_wider(names_from = state_name, values_from = state_total) %>%
mutate_all(~replace(., is.na(.), 0)) #coerce missing values to 0
#do the division
for(i in 1:length(state_names)) {
state = state_names[i]
total = total_names[i]
samesex_staterate <- samesex_staterate %>%
mutate(!!state := !!sym(state)/!!sym(total))
}
samesex_staterate <- samesex_staterate %>%
select(YEAR, AK:WY) %>%
pivot_longer(AK:WY, names_to = "state_name") %>%
rename(staterate_year = value) %>%
mutate(staterate_year = staterate_year * 100)
rm(df, merged_totals, df_statetotals, df_yeartotals, col_name, i, indv_names, state, state_names, total, total_names)
gc()
#BACK TO BEGINNING
#ID key variables to merge back in
extra_variables <- df_samesex %>%
distinct(YEAR, state_name, time_since_legalization)
#merge back in - think about implications of extra_variables having extra rows relative to state rate
output <-samesex_staterate %>%
left_join(extra_variables, join_by(YEAR, state_name)) %>%
left_join(FRED, join_by(YEAR, state_name))
#make dummy variables for 1-2, 3-4, 5-6, >7 years (interest results with/without all of this filtering including above)
output <- output %>%
mutate(time_leg_chunked = case_when(
time_since_legalization == 1 ~ 2,
time_since_legalization == 2 ~ 2,
time_since_legalization == 3 ~ 4,
time_since_legalization == 4 ~ 4,
time_since_legalization == 5 ~ 6,
time_since_legalization == 6 ~ 6,
time_since_legalization >= 7 ~ 7,
))
rm(samesex_staterate, extra_variables)
gc()
write.csv(output, "C:\\Users\\njrich\\Desktop\\same-sex-migration\\st_m.csv")
write_dta(output, "C:\\Users\\njrich\\Desktop\\same-sex-migration\\st_m.dta") #fill in rest by gender
gc()
df <- df_samesex_st_m
#make year totals excluding each state (no migrant restrictions)
df_yeartotals <- df
state_names <- unique(df$state_name)
indv_names <- paste(state_names, "excluded_indv", sep = "_")
for(i in 1:length(state_names)) {
df_yeartotals <- df_yeartotals %>% #restrict this to gay earlier?
mutate(column = if_else(state_name != state_names[i], in_samesex_weighted, 0)) %>%
rename(!!indv_names[i] := column) #thank you chatgpt
}
gc()
total_names <- paste(state_names, "excluded_total", sep = "_")
for(i in 1:length(state_names)) {
col_name <- indv_names[i] #thank you data.frame
df_yeartotals <- df_yeartotals %>%
group_by(YEAR) %>%
mutate(columned = sum(!!sym(col_name), na.rm = T)) %>% #this seems to work oi thanks chatgpt, just missing na.rm = T? why work Mac earlier?
ungroup() %>%
rename(!!total_names[i] := columned)
}
df_yeartotals <- df_yeartotals %>%
select(YEAR, state_name, AL_excluded_total:WY_excluded_total)
#make state year totals
df_statetotals <- df %>%
filter(MIGPLAC1 > 0 & MIGPLAC1 < 57) %>%
group_by(YEAR, state_name) %>%
summarize(state_total = sum(in_samesex_weighted, na.rm = T)) %>%
ungroup()
#some states don't exist here so convert later to 0
#set up division
merged_totals <- df_statetotals %>%
left_join(df_yeartotals, join_by(YEAR, state_name), multiple = "any") #yay get rid of duplicates
samesex_staterate <- merged_totals %>% #oopsy amount of variable names
pivot_wider(names_from = state_name, values_from = state_total) %>%
mutate_all(~replace(., is.na(.), 0)) #coerce missing values to 0
#do the division
for(i in 1:length(state_names)) {
state = state_names[i]
total = total_names[i]
samesex_staterate <- samesex_staterate %>%
mutate(!!state := !!sym(state)/!!sym(total))
}
samesex_staterate <- samesex_staterate %>%
select(YEAR, AK:WY) %>%
pivot_longer(AK:WY, names_to = "state_name") %>%
rename(staterate_year = value) %>%
mutate(staterate_year = staterate_year * 100)
rm(df, merged_totals, df_statetotals, df_yeartotals, col_name, i, indv_names, state, state_names, total, total_names)
gc()
#BACK TO BEGINNING
#ID key variables to merge back in
extra_variables <- df_samesex %>%
distinct(YEAR, state_name, time_since_legalization)
#merge back in - think about implications of extra_variables having extra rows relative to state rate
output <-samesex_staterate %>%
left_join(extra_variables, join_by(YEAR, state_name)) %>%
left_join(FRED, join_by(YEAR, state_name))
#make dummy variables for 1-2, 3-4, 5-6, >7 years (interest results with/without all of this filtering including above)
output <- output %>%
mutate(time_leg_chunked = case_when(
time_since_legalization == 1 ~ 2,
time_since_legalization == 2 ~ 2,
time_since_legalization == 3 ~ 4,
time_since_legalization == 4 ~ 4,
time_since_legalization == 5 ~ 6,
time_since_legalization == 6 ~ 6,
time_since_legalization >= 7 ~ 7,
))
rm(samesex_staterate, extra_variables)
gc()
write.csv(output, "C:\\Users\\njrich\\Desktop\\same-sex-migration\\st_f.csv")
write_dta(output, "C:\\Users\\njrich\\Desktop\\same-sex-migration\\st_f.dta") #fill in rest by gender
rm(list = ls())
