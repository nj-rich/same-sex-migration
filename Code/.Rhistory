scale_x_continuous(breaks = 2011:2019) +
theme_apa() #can always go back to theme
post_migrant_trends_chart
?scale_shape_manual
?scale_linetype_manual
gc()
ante_migrant_trends_chart <- ante_migrant_trends_df %>%
mutate(year = factor(year)) %>%
ggplot() +
geom_point(aes(x = year, y = frac_migrate, linetype = subgroup, color = subgroup)) +
labs(title = "Ex-Ante Triple Regression Visualized",
y = "Fraction Migrated",
color = "Subgroup") +
geom_vline(xintercept = factor(2015), color = "black", linetype = "dashed") + #bc factor issues
scale_color_manual(values = c("samesex_oldlegal" = "#EECC66", "oppositesex_oldlegal" = "#EE99AA", "samesex_newlegal" = "#6699CC", "oppositesex_newlegal" = "#997700"),
labels = c("samesex_oldlegal" = "Same-Sex Individuals in Locally Legalized States", "oppositesex_oldlegal" = "Opposite-Sex Individuals in Locally Legalized States", "samesex_newlegal" = "Same-Sex Individuals in Federally Legalized States", "oppositesex_newlegal" = "Opposite-Sex Individuals in Federally Legalized States")) +
theme_apa()
gc()
post_migrant_trends_chart <- post_migrant_trends_df %>%
ggplot() +
geom_line(aes(x = year, y = frac_migrate, color = subgroup)) + #linetype = subgroup,
labs(title = "Ex-Post Triple Regression Visualized",
y = "Fraction Migrated",
color = "Subgroup") + #maybe move title to plot itself
geom_vline(xintercept = 2015, color = "black", linetype = "dashed") + #bc factor issues
scale_linetype_manual(values = c("samesex_oldlegal" = "solid", "oppositesex_oldlegal" = "dotted", "samesex_newlegal" = "longdash", "oppositesex_newlegal" = "dotdash"),
labels = c("samesex_oldlegal" = "Same-Sex Individuals in Locally Legalized States", "oppositesex_oldlegal" = "Opposite-Sex Individuals in Locally Legalized States", "samesex_newlegal" = "Same-Sex Individuals in Federally Legalized States", "oppositesex_newlegal" = "Opposite-Sex Individuals in Federally Legalized States")) +
scale_x_continuous(breaks = 2011:2019) +
theme_apa() #can always go back to theme
post_migrant_trends_chart
gc()
post_migrant_trends_chart <- post_migrant_trends_df %>%
ggplot() +
geom_line(aes(x = year, y = frac_migrate, linetype = subgroup)) +
labs(title = "Ex-Post Triple Regression Visualized",
y = "Fraction Migrated",
color = "Subgroup") + #maybe move title to plot itself
geom_vline(xintercept = 2015, color = "black", linetype = "dashed") + #bc factor issues
scale_linetype_manual(values = c("samesex_oldlegal" = "solid", "oppositesex_oldlegal" = "dotted", "samesex_newlegal" = "longdash", "oppositesex_newlegal" = "dotdash"),
labels = c("samesex_oldlegal" = "Same-Sex Individuals in Locally Legalized States", "oppositesex_oldlegal" = "Opposite-Sex Individuals in Locally Legalized States", "samesex_newlegal" = "Same-Sex Individuals in Federally Legalized States", "oppositesex_newlegal" = "Opposite-Sex Individuals in Federally Legalized States")) +
scale_x_continuous(breaks = 2011:2019) +
theme_apa() #can always go back to theme
post_migrant_trends_chart
ante_migrant_trends_df <- summary_stats %>%
mutate(subgroup = case_when(
in_samesex == 1 & exante_old_legal == 1 ~ "samesex_oldlegal",
in_samesex == 0 & exante_old_legal == 1 ~ "oppositesex_oldlegal",
in_samesex == 1 & exante_old_legal == 0 ~ "samesex_newlegal",
in_samesex == 0 & exante_old_legal == 0 ~ "oppositesex_newlegal"
)) %>%
group_by(year, subgroup) %>%
summarize(frac_migrate = survey_mean(migrant, na.rm = T)) %>%
select(-frac_migrate_se)
#chart for export
gc()
ante_migrant_trends_chart <- ante_migrant_trends_df %>%
ggplot() +
geom_line(aes(x = year, y = frac_migrate, linetype = subgroup)) +
labs(title = "Ex-Ante Triple Regression Visualized",
y = "Fraction Migrated",
color = "Subgroup") +
geom_vline(xintercept = 2015, color = "black", linetype = "dashed") + #bc factor issues
scale_linetype_manual(values = c("samesex_oldlegal" = "solid", "oppositesex_oldlegal" = "dotted", "samesex_newlegal" = "longdash", "oppositesex_newlegal" = "dotdash"),
labels = c("samesex_oldlegal" = "Same-Sex Individuals in Locally Legalized States", "oppositesex_oldlegal" = "Opposite-Sex Individuals in Locally Legalized States", "samesex_newlegal" = "Same-Sex Individuals in Federally Legalized States", "oppositesex_newlegal" = "Opposite-Sex Individuals in Federally Legalized States")) +
scale_x_continuous(breaks = 2011:2019) +
theme_apa()
View(post_migrant_trends_df)
post_migrant_trends_table <- post_migrant_trends_df %>%
pivot_wider(names_from = subgroup, values_from = frac_migrate) %>%
select(year, samesex_newlegal, oppositesex_newlegal, samesex_oldlegal, oppositesex_oldlegal)
View(post_migrant_trends_table)
View(post_migrant_trends_table)
ante_migrant_trends_df <- summary_stats %>%
mutate(subgroup = case_when(
in_samesex == 1 & exante_old_legal == 1 ~ "samesex_oldlegal",
in_samesex == 0 & exante_old_legal == 1 ~ "oppositesex_oldlegal",
in_samesex == 1 & exante_old_legal == 0 ~ "samesex_newlegal",
in_samesex == 0 & exante_old_legal == 0 ~ "oppositesex_newlegal"
)) %>%
group_by(year, subgroup) %>%
summarize(frac_migrate = survey_mean(migrant, na.rm = T)) %>%
select(-frac_migrate_se)
#trends chart for export
gc()
ante_migrant_trends_chart <- ante_migrant_trends_df %>%
ggplot() +
geom_line(aes(x = year, y = frac_migrate, linetype = subgroup)) +
labs(title = "Ex-Ante Triple Regression Visualized",
y = "Fraction Migrated",
color = "Subgroup") +
geom_vline(xintercept = 2015, color = "black", linetype = "dashed") + #bc factor issues
scale_linetype_manual(values = c("samesex_oldlegal" = "solid", "oppositesex_oldlegal" = "dotted", "samesex_newlegal" = "longdash", "oppositesex_newlegal" = "dotdash"),
labels = c("samesex_oldlegal" = "Same-Sex Individuals in Locally Legalized States", "oppositesex_oldlegal" = "Opposite-Sex Individuals in Locally Legalized States", "samesex_newlegal" = "Same-Sex Individuals in Federally Legalized States", "oppositesex_newlegal" = "Opposite-Sex Individuals in Federally Legalized States")) +
scale_x_continuous(breaks = 2011:2019) +
theme_apa()
ante_migrant_trends_chart
#table for export
ante_migrant_trends_table <- ante_migrant_trends_df %>%
pivot_wider(names_from = subgroup, values_from = frac_migrate) %>%
mutate(samesex_diff = samesex_oldlegal - samesex_newlegal) %>%
mutate(oppositesex_diff = oppositesex_oldlegal - oppositesex_newlegal) %>%
select(year, samesex_oldlegal, samesex_newlegal, samesex_diff, oppositesex_oldlegal, oppositesex_newlegal, oppositesex_diff)
#table for export
post_migrant_trendsdiff_table <- post_migrant_trends_df %>%
pivot_wider(names_from = subgroup, values_from = frac_migrate) %>%
mutate(samesex_diff = samesex_oldlegal - samesex_newlegal) %>%
mutate(oppositesex_diff = oppositesex_oldlegal - oppositesex_newlegal) %>%
select(year, samesex_oldlegal, samesex_newlegal, samesex_diff, oppositesex_oldlegal, oppositesex_newlegal, oppositesex_diff)
View(post_migrant_trendsdiff_table)
?pivot_longer
gc()
post_migrant_diffs_chart <- post_migrant_trendsdiff_table %>%
pivot_longer(cols = c(samesex_diff, oppositesex_diff), names_to = "subgroup")
View(post_migrant_diffs_chart)
gc()
post_migrant_diffs_chart <- post_migrant_trendsdiff_table %>%
select(year, samesex_diff, oppositesex_diff) %>%
pivot_longer(cols = c(samesex_diff, oppositesex_diff), names_to = "subgroup")
View(post_migrant_diffs_chart)
gc()
post_migrant_diffs_chart <- post_migrant_trendsdiff_table %>%
select(year, samesex_diff, oppositesex_diff) %>%
pivot_longer(cols = c(samesex_diff, oppositesex_diff), names_to = "subgroup", values_to= "diffs")
ggplot() +
geom_line(aes(x = year, y = diffs, linetype = subgroup)) +
labs(title = "Ex-Post Triple Regression Visualized",
x = "Year",
y = "Fraction Migrated",
linetype = "Subgroup") + #maybe move title to plot itself
geom_vline(xintercept = 2015, color = "black", linetype = "dashed") + #bc factor issues
scale_linetype_manual(values = c("samesex_diff" = "solid", "oppositesex_diff" = "dashed"),
labels = c("samesex_diff" = "Same-Sex Locally - Federally Legalized", "oppositesex_diff" = "Same-Sex Locally - Federally Legalized")) +
scale_x_continuous(breaks = 2011:2019) +
theme_apa() #can always go back to theme
gc()
post_migrant_diffs_chart <- post_migrant_trendsdiff_table %>%
select(year, samesex_diff, oppositesex_diff) %>%
pivot_longer(cols = c(samesex_diff, oppositesex_diff), names_to = "subgroup", values_to= "diffs") %>%
ggplot() +
geom_line(aes(x = year, y = diffs, linetype = subgroup)) +
labs(title = "Ex-Post Triple Regression Visualized",
x = "Year",
y = "Fraction Migrated",
linetype = "Subgroup") + #maybe move title to plot itself
geom_vline(xintercept = 2015, color = "black", linetype = "dashed") + #bc factor issues
scale_linetype_manual(values = c("samesex_diff" = "solid", "oppositesex_diff" = "dashed"),
labels = c("samesex_diff" = "Same-Sex Locally - Federally Legalized", "oppositesex_diff" = "Same-Sex Locally - Federally Legalized")) +
scale_x_continuous(breaks = 2011:2019) +
theme_apa() #can always go back to theme
post_migrant_diffs_chart
gc()
post_migrant_diffs_chart <- post_migrant_trendsdiff_table %>%
select(year, samesex_diff, oppositesex_diff) %>%
pivot_longer(cols = c(samesex_diff, oppositesex_diff), names_to = "subgroup", values_to= "diffs") %>%
ggplot() +
geom_line(aes(x = year, y = diffs, linetype = subgroup)) +
labs(title = "Ex-Post Triple Regression Visualized",
x = "Year",
y = "Migration to Locally - Federally Legalized States",
linetype = "Subgroup") + #maybe move title to plot itself
geom_vline(xintercept = 2015, color = "black", linetype = "dashed") + #bc factor issues
scale_linetype_manual(values = c("samesex_diff" = "solid", "oppositesex_diff" = "dashed"),
labels = c("samesex_diff" = "Same-Sex Individuals", "oppositesex_diff" = "Opposite-Sex Individuals")) +
scale_x_continuous(breaks = 2011:2019) +
theme_apa() #can always go back to theme
post_migrant_diffs_chart
gc()
post_migrant_trends_chart <- post_migrant_trends_df %>%
ggplot() +
geom_line(aes(x = year, y = frac_migrate, linetype = subgroup)) +
labs(title = "Ex-Post Trends Visualized",
x = "Year",
y = "Fraction Migrated",
linetype = "Subgroup") + #maybe move title to plot itself
geom_vline(xintercept = 2015, color = "black", linetype = "dashed") + #bc factor issues
scale_linetype_manual(values = c("samesex_oldlegal" = "solid", "oppositesex_oldlegal" = "dotted", "samesex_newlegal" = "longdash", "oppositesex_newlegal" = "dotdash"),
labels = c("samesex_oldlegal" = "Same-Sex Individuals in Locally Legalized States", "oppositesex_oldlegal" = "Opposite-Sex Individuals in Locally Legalized States", "samesex_newlegal" = "Same-Sex Individuals in Federally Legalized States", "oppositesex_newlegal" = "Opposite-Sex Individuals in Federally Legalized States")) +
scale_x_continuous(breaks = 2011:2019) +
theme_apa() #can always go back to theme
post_migrant_trends_chart
post_migrant_trends_chart
post_migrant_diffs_chart
gc()
ante_migrant_diffs_chart <- ante_migrant_trendsdiff_table %>%
select(year, samesex_diff, oppositesex_diff) %>%
pivot_longer(cols = c(samesex_diff, oppositesex_diff), names_to = "subgroup", values_to= "diffs") %>%
ggplot() +
geom_line(aes(x = year, y = diffs, linetype = subgroup)) +
labs(title = "Ex-Ante Triple Regression Visualized",
x = "Year",
y = "Migration to Locally - Federally Legalized States",
linetype = "Subgroup") + #maybe move title to plot itself
geom_vline(xintercept = 2015, color = "black", linetype = "dashed") + #bc factor issues
scale_linetype_manual(values = c("samesex_diff" = "solid", "oppositesex_diff" = "dashed"),
labels = c("samesex_diff" = "Same-Sex Individuals", "oppositesex_diff" = "Opposite-Sex Individuals")) +
scale_x_continuous(breaks = 2011:2019) +
theme_apa() #can always go back to theme
#table for export
ante_migrant_trendsdiffs_table <- ante_migrant_trends_df %>%
pivot_wider(names_from = subgroup, values_from = frac_migrate) %>%
mutate(samesex_diff = samesex_oldlegal - samesex_newlegal) %>%
mutate(oppositesex_diff = oppositesex_oldlegal - oppositesex_newlegal) %>%
select(year, samesex_oldlegal, samesex_newlegal, samesex_diff, oppositesex_oldlegal, oppositesex_newlegal, oppositesex_diff)
ante_migrant_diffs_chart <- ante_migrant_trendsdiff_table %>%
select(year, samesex_diff, oppositesex_diff) %>%
pivot_longer(cols = c(samesex_diff, oppositesex_diff), names_to = "subgroup", values_to= "diffs") %>%
ggplot() +
geom_line(aes(x = year, y = diffs, linetype = subgroup)) +
labs(title = "Ex-Ante Triple Regression Visualized",
x = "Year",
y = "Migration to Locally - Federally Legalized States",
linetype = "Subgroup") + #maybe move title to plot itself
geom_vline(xintercept = 2015, color = "black", linetype = "dashed") + #bc factor issues
scale_linetype_manual(values = c("samesex_diff" = "solid", "oppositesex_diff" = "dashed"),
labels = c("samesex_diff" = "Same-Sex Individuals", "oppositesex_diff" = "Opposite-Sex Individuals")) +
scale_x_continuous(breaks = 2011:2019) +
theme_apa() #can always go back to theme
#table for export
ante_migrant_trendsdiffs_table <- ante_migrant_trends_df %>%
pivot_wider(names_from = subgroup, values_from = frac_migrate) %>%
mutate(samesex_diff = samesex_oldlegal - samesex_newlegal) %>%
mutate(oppositesex_diff = oppositesex_oldlegal - oppositesex_newlegal) %>%
select(year, samesex_oldlegal, samesex_newlegal, samesex_diff, oppositesex_oldlegal, oppositesex_newlegal, oppositesex_diff)
ante_migrant_diffs_chart <- ante_migrant_trendsdiffs_table %>%
select(year, samesex_diff, oppositesex_diff) %>%
pivot_longer(cols = c(samesex_diff, oppositesex_diff), names_to = "subgroup", values_to= "diffs") %>%
ggplot() +
geom_line(aes(x = year, y = diffs, linetype = subgroup)) +
labs(title = "Ex-Ante Triple Regression Visualized",
x = "Year",
y = "Migration to Locally - Federally Legalized States",
linetype = "Subgroup") + #maybe move title to plot itself
geom_vline(xintercept = 2015, color = "black", linetype = "dashed") + #bc factor issues
scale_linetype_manual(values = c("samesex_diff" = "solid", "oppositesex_diff" = "dashed"),
labels = c("samesex_diff" = "Same-Sex Individuals", "oppositesex_diff" = "Opposite-Sex Individuals")) +
scale_x_continuous(breaks = 2011:2019) +
theme_apa() #can always go back to theme
ante_migrant_diffs_chart
colnames(clean_df)
gc()
#ex-post
#df
post_migrant_trends_df <- summary_stats %>%
mutate(subgroup = case_when(
in_samesex == 1 & expost_old_legal == 1 ~ "samesex_oldlegal",
in_samesex == 0 & expost_old_legal == 1 ~ "oppositesex_oldlegal",
in_samesex == 1 & expost_old_legal == 0 ~ "samesex_newlegal",
in_samesex == 0 & expost_old_legal == 0 ~ "oppositesex_newlegal"
)) %>%
group_by(year, subgroup) %>%
summarize(frac_migrate = survey_mean(migrant, na.rm = T)) %>%
select(-frac_migrate_se)
#table for export
post_migrant_trendsdiffs_table <- post_migrant_trends_df %>%
pivot_wider(names_from = subgroup, values_from = frac_migrate) %>%
mutate(samesex_diff = samesex_oldlegal - samesex_newlegal) %>%
mutate(oppositesex_diff = oppositesex_oldlegal - oppositesex_newlegal) %>%
select(year, samesex_oldlegal, samesex_newlegal, samesex_diff, oppositesex_oldlegal, oppositesex_newlegal, oppositesex_diff)
#trends chart for export
gc()
post_migrant_trends_chart <- post_migrant_trends_df %>%
ggplot() +
geom_line(aes(x = year, y = frac_migrate, linetype = subgroup)) +
labs(title = "Ex-Post Trends Visualized",
x = "Year",
y = "Fraction Migrated",
linetype = "Subgroup") + #maybe move title to plot itself
geom_vline(xintercept = 2015, color = "black", linetype = "dashed") + #bc factor issues
scale_linetype_manual(values = c("samesex_oldlegal" = "solid", "oppositesex_oldlegal" = "dotted", "samesex_newlegal" = "longdash", "oppositesex_newlegal" = "dotdash"),
labels = c("samesex_oldlegal" = "Same-Sex Individuals in Locally Legalized States", "oppositesex_oldlegal" = "Opposite-Sex Individuals in Locally Legalized States", "samesex_newlegal" = "Same-Sex Individuals in Federally Legalized States", "oppositesex_newlegal" = "Opposite-Sex Individuals in Federally Legalized States")) +
scale_x_continuous(breaks = 2011:2019) +
theme_apa() #can always go back to theme
post_migrant_trends_chart
#diffs chart for export
gc()
post_migrant_diffs_chart <- post_migrant_trendsdiffs_table %>%
select(year, samesex_diff, oppositesex_diff) %>%
pivot_longer(cols = c(samesex_diff, oppositesex_diff), names_to = "subgroup", values_to= "diffs") %>%
ggplot() +
geom_line(aes(x = year, y = diffs, linetype = subgroup)) +
labs(title = "Ex-Post Triple Regression Visualized",
x = "Year",
y = "Migration to Locally - Federally Legalized States",
linetype = "Subgroup") + #maybe move title to plot itself
geom_vline(xintercept = 2015, color = "black", linetype = "dashed") + #bc factor issues
scale_linetype_manual(values = c("samesex_diff" = "solid", "oppositesex_diff" = "dashed"),
labels = c("samesex_diff" = "Same-Sex Individuals", "oppositesex_diff" = "Opposite-Sex Individuals")) +
scale_x_continuous(breaks = 2011:2019) +
theme_apa() #can always go back to theme
post_migrant_diffs_chart
#ante
#df
ante_migrant_trends_df <- summary_stats %>%
mutate(subgroup = case_when(
in_samesex == 1 & exante_old_legal == 1 ~ "samesex_oldlegal",
in_samesex == 0 & exante_old_legal == 1 ~ "oppositesex_oldlegal",
in_samesex == 1 & exante_old_legal == 0 ~ "samesex_newlegal",
in_samesex == 0 & exante_old_legal == 0 ~ "oppositesex_newlegal"
)) %>%
group_by(year, subgroup) %>%
summarize(frac_migrate = survey_mean(migrant, na.rm = T)) %>%
select(-frac_migrate_se)
#table for export
ante_migrant_trendsdiffs_table <- ante_migrant_trends_df %>%
pivot_wider(names_from = subgroup, values_from = frac_migrate) %>%
mutate(samesex_diff = samesex_oldlegal - samesex_newlegal) %>%
mutate(oppositesex_diff = oppositesex_oldlegal - oppositesex_newlegal) %>%
select(year, samesex_oldlegal, samesex_newlegal, samesex_diff, oppositesex_oldlegal, oppositesex_newlegal, oppositesex_diff)
#trends chart for export
gc()
ante_migrant_trends_chart <- ante_migrant_trends_df %>%
ggplot() +
geom_line(aes(x = year, y = frac_migrate, linetype = subgroup)) +
labs(title = "Ex-Ante Trends Visualized",
x = "Year",
y = "Fraction Migrated",
linetype = "Subgroup") +
geom_vline(xintercept = 2015, color = "black", linetype = "dashed") + #bc factor issues
scale_linetype_manual(values = c("samesex_oldlegal" = "solid", "oppositesex_oldlegal" = "dotted", "samesex_newlegal" = "longdash", "oppositesex_newlegal" = "dotdash"),
labels = c("samesex_oldlegal" = "Same-Sex Individuals in Locally Legalized States", "oppositesex_oldlegal" = "Opposite-Sex Individuals in Locally Legalized States", "samesex_newlegal" = "Same-Sex Individuals in Federally Legalized States", "oppositesex_newlegal" = "Opposite-Sex Individuals in Federally Legalized States")) +
scale_x_continuous(breaks = 2011:2019) +
theme_apa()
ante_migrant_trends_chart
#diffs chart for export
gc()
ante_migrant_diffs_chart <- ante_migrant_trendsdiffs_table %>%
select(year, samesex_diff, oppositesex_diff) %>%
pivot_longer(cols = c(samesex_diff, oppositesex_diff), names_to = "subgroup", values_to= "diffs") %>%
ggplot() +
geom_line(aes(x = year, y = diffs, linetype = subgroup)) +
labs(title = "Ex-Ante Triple Regression Visualized",
x = "Year",
y = "Migration to Locally - Federally Legalized States",
linetype = "Subgroup") + #maybe move title to plot itself
geom_vline(xintercept = 2015, color = "black", linetype = "dashed") + #bc factor issues
scale_linetype_manual(values = c("samesex_diff" = "solid", "oppositesex_diff" = "dashed"),
labels = c("samesex_diff" = "Same-Sex Individuals", "oppositesex_diff" = "Opposite-Sex Individuals")) +
scale_x_continuous(breaks = 2011:2019) +
theme_apa() #can always go back to theme
ante_migrant_diffs_chart
#export charts
ggsave("/Users/njrich/Desktop/same-sex-migration/outputs/summary_stats/post_trends.png", plot = post_migrant_trends_chart)
ggsave("/Users/njrich/Desktop/same-sex-migration/outputs/summary_stats/post_diffs.png", plot = post_migrant_diffs_chart)
ggsave("/Users/njrich/Desktop/same-sex-migration/outputs/summary_stats/ante_trends.png", plot = ante_migrant_trends_chart)
ggsave("/Users/njrich/Desktop/same-sex-migration/outputs/summary_stats/ante_diffs.png", plot = ante_migrant_diffs_chart)
#export joint table
joint_trendsdiffs_table <- post_migrant_trendsdiffs_table %>%
left_join(ante_migrant_trendsdiffs_table, by = "year") %>%
setNames(c("Year", "Locally Legalized", "Federally Legalized", "Difference", "Locally Legalized", "Federally Legalized", "Difference", "Locally Legalized", "Federally Legalized", "Difference", "Locally Legalized", "Federally Legalized", "Difference")) %>%
kable(caption = "Migration Trends Data", format = "latex", booktabs = T, digits = 3) %>%
add_header_above(c("" = 1, "Same-Sex" = 2, "" = 1, "Opposite-Sex" = 2, "" = 1, "Same-Sex" = 2, "" = 1, "Opposite-Sex" = 2, "" = 1))  %>% #hmm reorganize to make more sense?
add_header_above(c("" = 1, "Fraction Moving To" = 6, "Fraction Moving From" = 6))
#export joint table
joint_trendsdiffs_table <- post_migrant_trendsdiffs_table %>%
left_join(ante_migrant_trendsdiffs_table, by = "year") %>%
setNames(c("Year", "Locally Legalized", "Federally Legalized", "Difference", "Locally Legalized", "Federally Legalized", "Difference", "Locally Legalized", "Federally Legalized", "Difference", "Locally Legalized", "Federally Legalized", "Difference")) %>%
kable(caption = "Migration Trends Data", format = "latex", booktabs = T, digits = 3) %>%
add_header_above(c(" " = 1, "Same-Sex" = 2, "" = 1, "Opposite-Sex" = 2, " " = 1, "Same-Sex" = 2, " " = 1, "Opposite-Sex" = 2, " " = 1))  %>% #hmm reorganize to make more sense?
add_header_above(c(" " = 1, "Fraction Moving To" = 6, "Fraction Moving From" = 6))
joint_trendsdiffs_table <- post_migrant_trendsdiffs_table %>%
left_join(ante_migrant_trendsdiffs_table, by = "year") %>%
setNames(c("Year", "Locally Legalized", "Federally Legalized", "Difference", "Locally Legalized", "Federally Legalized", "Difference", "Locally Legalized", "Federally Legalized", "Difference", "Locally Legalized", "Federally Legalized", "Difference")) %>%
kable(caption = "Migration Trends Data", format = "latex", booktabs = T, digits = 3) %>%
add_header_above(c(" " = 1, "Same-Sex" = 2, " " = 1, "Opposite-Sex" = 2, " " = 1, "Same-Sex" = 2, " " = 1, "Opposite-Sex" = 2, " " = 1))  %>% #hmm reorganize to make more sense?
add_header_above(c(" " = 1, "Fraction Moving To" = 6, "Fraction Moving From" = 6))
writeLines(joint_trendsdiff_table, "/Users/njrich/Desktop/same-sex-migration/outputs/summary_stats/trendsdiff_table.tex")
writeLines(joint_trendsdiffs_table, "/Users/njrich/Desktop/same-sex-migration/outputs/summary_stats/trendsdiffs_table.tex")
gc()
#count male/female among those in same-sex relationships
prop_fem_samesex <- summary_stats %>%
mutate(sex = ifelse(sex == 9, NA, sex - 1)) %>%
group_by(year, in_samesex) %>%
summarize(prop_fem = survey_mean(sex, na.rm = T)) %>%
select(-prop_fem_se) %>%
mutate(in_samesex = ifelse(in_samesex == 1, "Same-Sex Sex", "Opposite-Sex Sex")) %>%
pivot_wider(names_from = in_samesex, values_from = prop_fem) %>%
select(year, "Same-Sex Sex", "Opposite-Sex Sex")
gc()
#fraction with children table
#need to import variables for this
gc()
#mean age by same-sex/opposite-sex weighted, by year
mean_age_samesex <- summary_stats %>%
group_by(year, in_samesex) %>%
summarize(mean_age = survey_mean(age, na.rm = T)) %>%
select(-mean_age_se) %>%
mutate(in_samesex = ifelse(in_samesex == 1, "Same-Sex Age", "Opposite-Sex Age")) %>%
pivot_wider(names_from = in_samesex, values_from = mean_age) %>%
select(year, "Same-Sex Age", "Opposite-Sex Age")
gc()
#fraction >=4 years college attainment by same-sex/opposite-sex weighted, by year
frac_college_samesex <- summary_stats %>%
mutate(four_years_college = ifelse(educ >= 10, 1, 0)) %>%
group_by(year, in_samesex) %>%
summarize(frac_college = survey_mean(four_years_college, na.rm = T)) %>%
select(-frac_college_se) %>%
mutate(in_samesex = ifelse(in_samesex == 1, "Same-Sex College", "Opposite-Sex College")) %>%
pivot_wider(names_from = in_samesex, values_from = frac_college) %>%
select(year, "Same-Sex College", "Opposite-Sex College")
gc()
#fraction white by same-sex/opposite-sex weighted, by year
frac_white_samesex <- summary_stats %>%
mutate(white = ifelse(race == 1, 1, 0)) %>%
group_by(year, in_samesex) %>%
summarize(frac_white = survey_mean(white, na.rm = T)) %>%
select(-frac_white_se) %>%
mutate(in_samesex = ifelse(in_samesex == 1, "Same-Sex White", "Opposite-Sex White")) %>%
pivot_wider(names_from = in_samesex, values_from = frac_white)  %>%
select(year, "Same-Sex White", "Opposite-Sex White")
gc()
#mean income by same-sex/opposite-sex weighted, by year
mean_income_samesex <- summary_stats %>%
group_by(year, in_samesex) %>%
summarize(mean_income = survey_mean(inctot, na.rm = T)) %>%
select(-mean_income_se) %>%
mutate(in_samesex = ifelse(in_samesex == 1, "Same-Sex Inc", "Opposite-Sex Inc")) %>%
pivot_wider(names_from = in_samesex, values_from = mean_income) %>%
select(year, "Same-Sex Inc", "Opposite-Sex Inc")
#frac have children by same-sex/opposite-sex weighted, by year
frac_child_samesex <- summary_stats %>%
group_by(year, in_samesex) %>%
summarize(frac_child = survey_mean(has_child, na.rm = T)) %>%
select(-frac_child_se) %>%
mutate(in_samesex = ifelse(in_samesex == 1, "Same-Sex Child", "Opposite-Sex Child")) %>%
pivot_wider(names_from = in_samesex, values_from = frac_child) %>%
select(year, "Same-Sex Child", "Opposite-Sex Child")
gc()
#create joint table
joint_control_table <- prop_fem_samesex %>%
left_join(mean_age_samesex, by = "year") %>%
left_join(frac_college_samesex, by = "year") %>%
left_join(frac_white_samesex, by = "year") %>%
left_join(mean_income_samesex, by = "year") %>%
left_join(frac_child_samesex, by = "year") %>%
setNames(c("Year", "Same-Sex", "Opposite-Sex", "Same-Sex", "Opposite-Sex", "Same-Sex", "Opposite-Sex", "Same-Sex", "Opposite-Sex", "Same-Sex", "Opposite-Sex", "Same-Sex", "Opposite-Sex")) %>% #needs work
kable(caption = "Summary Statistics for Proposed Controls", format = "latex", booktabs = T, digits = 3) %>%
add_header_above(c(" " = 1, "%/100 Female" = 2, "Mean Age" = 2, "%/100 College" = 2, "%/100 White" = 2, "Mean Income" = 2, "%/100 Has Child" = 2))
#export joint table
<<<<<<< HEAD
writeLines(joint_location_table, "/Users/njrich/Desktop/same-sex-migration/outputs/summary_stats/locations_table.tex") #NOTE: THIS IS FOR MAC, WILL NEED TO ADJUST FOR WINDOWS
#need to abbreviate some titles
?rename
knitr::opts_chunk$set(echo = TRUE)
gc()
library(data.table) #for data loading
library(readxl) #for reading in FRED data
library(tidyverse) #for data work
install.packages("janitor")
library(janitor) #for clean_names
install.packages("srvyr")
library(srvyr) #for weighting
library(haven) #for stata data export/import
install.packages("stargazer")
library(stargazer) #for latex output
?rename
knitr::opts_chunk$set(echo = TRUE)
gc()
library(data.table) #for data loading
library(tidyverse) #for data work
install.packages("janitor")
library(janitor) #for clean_names
install.packages("srvyr")
library(srvyr) #for weighting
library(haven) #for reading in dta
install.packages("kableExtra") #to make more complicated output tables for LATEX
library(kableExtra)
install.packages("jtools") #for ggplot visualization
library(jtools)
gc()
#windows
# clean_df <- read_dta("C:\\Users\\njrich\\Downloads\\clean_dataframe.dta") %>%
#   clean_names()
#mac
clean_df <- read_dta("/Users/njrich/Downloads/clean_dataframe.dta") %>%
clean_names()
install.packages("jtools")
install.packages("kableExtra")
install.packages("kableExtra")
gc()
summary_stats <- as_survey(clean_df, weights = perwt) #note: exclude rep_wts so standard errors are inaccurate (file otherwise insanely big- talk someone about it)
gc()
#ex-post
#df
post_migrant_trends_df <- summary_stats %>%
mutate(subgroup = case_when(
in_samesex == 1 & expost_old_legal == 1 ~ "samesex_oldlegal",
in_samesex == 0 & expost_old_legal == 1 ~ "oppositesex_oldlegal",
in_samesex == 1 & expost_old_legal == 0 ~ "samesex_newlegal",
in_samesex == 0 & expost_old_legal == 0 ~ "oppositesex_newlegal"
)) %>%
group_by(year, subgroup) %>%
summarize(frac_migrate = survey_mean(migrant, na.rm = T)) %>%
select(-frac_migrate_se)
#chart for export
gc()
post_migrant_trends_chart <- post_migrant_trends_df %>%
mutate(year = factor(year)) %>%
ggplot() +
geom_point(aes(x = year, y = frac_migrate, linetype = subgroup, color = subgroup)) +
labs(title = "Ex-Post Triple Regression Visualized",
y = "Fraction Migrated",
color = "Subgroup") + #maybe move title to plot itself
geom_vline(xintercept = factor(2015), color = "black", linetype = "dashed") + #bc factor issues
scale_color_manual(values = c("samesex_oldlegal" = "#EECC66", "opppositesex_oldlegal" = "#EE99AA", "samesex_newlegal" = "#6699CC", "oppositesex_newlegal" = "#997700"),
labels = c("samesex_oldlegal" = "Same-Sex Individuals in Locally Legalized States", "opppositesex_oldlegal" = "Opposite-Sex Individuals in Locally Legalized States", "samesex_newlegal" = "Same-Sex Individuals in Federally Legalized States", "oppositesex_newlegal" = "Opposite-Sex Individuals in Federally Legalized States")) +
theme_apa() #can always go back to theme
post_migrant_trends_chart
post_migrant_trends_chart
=======
writeLines(joint_control_table, "/Users/njrich/Desktop/same-sex-migration/outputs/summary_stats/control_table.tex") #NOTE: THIS IS FOR MAC, WILL NEED TO ADJUST FOR WINDOWS
#watch column arranging
>>>>>>> ad5147a0649fc8ca29633d58b2b1c8ea494d3e88
