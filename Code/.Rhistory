col_name <- indv_names[i] #thank you data.frame
col <- df_samesex_mm[, .data[[col_name]], drop = F]
df_samesex_mm <- df_samesex_mm %>%
group_by(YEAR) %>%
mutate(column = sum(col)) %>%
rename(!!total_names[i] := column) #thank you chatgpt
}
test <- indv_names[1]
df_samesex_mm[, ..test, drop = F]
df_samesex_mm[[test]]
total_names <- paste(state_names, "excluded_total", sep = "_")
for(i in 1:length(state_names)) {
col_name <- indv_names[i] #thank you data.frame
col <- df_samesex_mm[[col_name]]
df_samesex_mm <- df_samesex_mm %>%
group_by(YEAR) %>%
mutate(column = sum(col)) %>%
rename(!!total_names[i] := column)%>% #thank you chatgpt
ungroup()
}
gc()
df_samesex_mm <- df_samesex %>%
filter(AGE >= 30 & AGE <= 64) %>%
filter(YEAR >= 2001 & YEAR <= 2015) %>% ##interesting include 2001
filter(MARST == 4 | MARST == 5 | MARST == 6) %>% #includes those divorced, widowed, never married/single (NOTE: this excludes those married, separated, blank/missing)
filter(!is.na(MIGPLAC1)) #get interstate migrants only
test_data <- df_samesex %>%
filter(in_samesex == 1)
gc()
write.csv(test_data, "C:\\Users\\njrich\\Desktop\\same-sex-migration\\test_data.csv")
rm(list = ls())
gc()
gc()
library(tidyverse) #for data work
library(data.table) #for data loading
library(haven) #for writing to dta
library(readxl) #for reading in FRED data
#watch these packages for dummies
install.packages("fastDummies") # --- recipes package might also work or tidymodels? (step_dummy maybe work darn recipe use confusion) (or not- different method) - issue: combo 2 years - check
library(fastDummies)
#test making state level pop estimates including state var
df_samesex_mm <- read_csv("/Users/njrich/Desktop/Econ495/same-sex-migration/test_data.csv")
#test making state level pop estimates including state var
df_samesex_mm <- fread("/Users/njrich/Desktop/Econ495/same-sex-migration/test_data.csv")
gc()
state_names <- unique(df_samesex_mm$state_name)
indv_names <- paste(state_names, "excluded_indv", sep = "_")
for(i in 1:length(state_names)) {
df_samesex_mm <- df_samesex_mm %>% #restrict this to gay earlier?
mutate(column = if_else(state_name != state_names[i], in_samesex_weighted, 0)) %>%
rename(!!indv_names[i] := column) #thank you chatgpt
}
for(i in 1:length(state_names)) {
col_name <- indv_names[i] #thank you data.frame
col <- df_samesex_mm[, ..col_name, drop = F]
df_samesex_mm <- df_samesex_mm %>%
group_by(YEAR) %>%
mutate(column = sum(col)) %>%
rename(!!total_names[i] := column) %>% #thank you chatgpt
ungroup()
}
total_names <- paste(state_names, "excluded_total", sep = "_")
for(i in 1:length(state_names)) {
col_name <- indv_names[i] #thank you data.frame
col <- df_samesex_mm[, ..col_name, drop = F]
df_samesex_mm <- df_samesex_mm %>%
group_by(YEAR) %>%
mutate(column = sum(col)) %>%
rename(!!total_names[i] := column) %>% #thank you chatgpt
ungroup()
}
total_names <- paste(state_names, "excluded_total", sep = "_")
for(i in 1:length(state_names)) {
col_name <- indv_names[i] #thank you data.frame
col <- df_samesex_mm[, .data(col_name), drop = F]
df_samesex_mm <- df_samesex_mm %>%
group_by(YEAR) %>%
mutate(column = sum(col)) %>%
rename(!!total_names[i] := column) %>% #thank you chatgpt
ungroup()
}
total_names <- paste(state_names, "excluded_total", sep = "_")
for(i in 1:length(state_names)) {
col_name <- indv_names[i] #thank you data.frame
col <- df_samesex_mm[, ..data(col_name), drop = F]
df_samesex_mm <- df_samesex_mm %>%
group_by(YEAR) %>%
mutate(column = sum(col)) %>%
rename(!!total_names[i] := column) %>% #thank you chatgpt
ungroup()
}
for(i in 1:length(state_names)) {
col_name <- indv_names[i] #thank you data.frame
col <- df_samesex_mm[col_name]
df_samesex_mm <- df_samesex_mm %>%
group_by(YEAR) %>%
mutate(column = sum(col)) %>%
rename(!!total_names[i] := column) %>% #thank you chatgpt
ungroup()
}
rlang::last_trace()
length(total_names)
length(distinct(total_names))
length(unique(total_names))
for(i in 1:length(state_names)) {
col_name <- indv_names[i] #thank you data.frame
col <- df_samesex_mm[col_name]
df_samesex_mm <- df_samesex_mm %>%
#    group_by(YEAR) %>% #I wonder if this is screwing things up
mutate(column = sum(col)) %>%
rename(!!total_names[i] := column) %>% #seem to be running into an issue on RI I think grouping is the issue
ungroup()
}
for(i in 1:length(state_names)) {
col_name <- indv_names[i] #thank you data.frame
col <- df_samesex_mm[col_name]
df_samesex_mm <- df_samesex_mm %>%
#    group_by(YEAR) %>% #I wonder if this is screwing things up
mutate(columned = sum(col)) %>%
rename(!!total_names[i] := columned) %>% #seem to be running into an issue on RI I think grouping is the issue
ungroup()
}
rm(list = ls())
gc()
#test making state level pop estimates including state var
df_samesex_mm <- fread("/Users/njrich/Desktop/Econ495/same-sex-migration/test_data.csv")
gc()
state_names <- unique(df_samesex_mm$state_name)
indv_names <- paste(state_names, "excluded_indv", sep = "_")
for(i in 1:length(state_names)) {
df_samesex_mm <- df_samesex_mm %>% #restrict this to gay earlier?
mutate(column = if_else(state_name != state_names[i], in_samesex_weighted, 0)) %>%
rename(!!indv_names[i] := column) #thank you chatgpt
}
View(df_samesex_mm)
total_names <- paste(state_names, "excluded_total", sep = "_")
for(i in 1:length(state_names)) {
col_name <- indv_names[i] #thank you data.frame
col <- df_samesex_mm[col_name]
df_samesex_mm <- df_samesex_mm %>%
#    group_by(YEAR) %>% #I wonder if this is screwing things up
mutate(columned = sum(col)) %>%
rename(!!total_names[i] := columned) %>% #seem to be running into an issue on RI I think grouping is the issue
ungroup()
}
for(i in 1:length(state_names)) {
col_name <- indv_names[i] #thank you data.frame
col <- df_samesex_mm[col_name]
df_samesex_mm <- df_samesex_mm %>%
#    group_by(YEAR) %>% #I wonder if this is screwing things up
mutate(columned = sum(col)) %>%
rename(!!total_names[i] := columned) #%>% #seem to be running into an issue on RI I think grouping is the issue
#    ungroup()
}
rm(list = ls())
df_samesex_mm <- fread("/Users/njrich/Desktop/Econ495/same-sex-migration/test_data.csv")
gc()
state_names <- unique(df_samesex_mm$state_name)
indv_names <- paste(state_names, "excluded_indv", sep = "_")
for(i in 1:length(state_names)) {
df_samesex_mm <- df_samesex_mm %>% #restrict this to gay earlier?
mutate(column = if_else(state_name != state_names[i], in_samesex_weighted, 0)) %>%
rename(!!indv_names[i] := column) #thank you chatgpt
}
total_names <- paste(state_names, "excluded_total", sep = "_")
for(i in 1:length(state_names)) {
col_name <- indv_names[i] #thank you data.frame
col <- df_samesex_mm[col_name]
df_samesex_mm <- df_samesex_mm %>%
#    group_by(YEAR) %>% #I wonder if this is screwing things up
mutate(columned = sum(col)) %>%
rename(!!total_names[i] := columned) #%>% #seem to be running into an issue on RI I think grouping is the issue
#    ungroup()
}
for(i in 1:length(state_names)) {
col_name <- indv_names[i] #thank you data.frame
col <- df_samesex_mm[col_name]
df_samesex_mm <- df_samesex_mm %>%
#    group_by(YEAR) %>% #I wonder if this is screwing things up
mutate(!!total_names[i] := sum(col)) #%>%
#    rename(!!total_names[i] := columned) #%>% #seem to be running into an issue on RI I think grouping is the issue
#    ungroup()
}
for(i in 1:length(state_names)) {
col_name <- indv_names[i] #thank you data.frame
col <- df_samesex_mm[col_name]
df_samesex_mm <- df_samesex_mm %>%
#    group_by(YEAR) %>% #I wonder if this is screwing things up
mutate(!!total_names[i] := sum(col, na.rm = T)) #%>%
#    rename(!!total_names[i] := columned) #%>% #seem to be running into an issue on RI I think grouping is the issue
#    ungroup()
}
for(i in 1:length(state_names)) {
col_name <- indv_names[i] #thank you data.frame
col <- df_samesex_mm[col_name]
total = sum(col, na.rm = T)
df_samesex_mm <- df_samesex_mm %>%
#    group_by(YEAR) %>% #I wonder if this is screwing things up
mutate(!!total_names[i] := total) #%>%
#    rename(!!total_names[i] := columned) #%>% #seem to be running into an issue on RI I think grouping is the issue
#    ungroup()
}
total_names <- paste(state_names, "excluded_total", sep = "_")
for(i in 1:length(state_names)) {
col_name <- indv_names[i] #thank you data.frame
col <- df_samesex_mm[col_name]
total = sum(col, na.rm = T)
df_samesex_mm <- df_samesex_mm %>%
#    group_by(YEAR) %>% #I wonder if this is screwing things up
mutate(columned := total) #%>%
rename(!!total_names[i] := columned) #%>% #seem to be running into an issue on RI I think grouping is the issue
#    ungroup()
}
for(i in 1:length(state_names)) {
col_name <- indv_names[i] #thank you data.frame
col <- df_samesex_mm[col_name]
total = sum(col, na.rm = T)
df_samesex_mm <- df_samesex_mm %>%
#    group_by(YEAR) %>% #I wonder if this is screwing things up
mutate(columned = total) #%>%
rename(!!total_names[i] := columned) #%>% #seem to be running into an issue on RI I think grouping is the issue
#    ungroup()
}
for(i in 1:length(state_names)) {
col_name <- indv_names[i] #thank you data.frame
col <- df_samesex_mm[, ..col_name, drop = F]
total = sum(col, na.rm = T) #won't work long term... maybe chunk?
df_samesex_mm <- df_samesex_mm %>%
#    group_by(YEAR) %>% #I wonder if this is screwing things up
mutate(columned = total) #%>%
rename(!!total_names[i] := columned) #%>% #seem to be running into an issue on RI I think grouping is the issue
#    ungroup()
}
for(i in 1:length(state_names)) {
col_name <- indv_names[i] #thank you data.frame
col <- df_samesex_mm[, ..col_name, drop = F]
total = sum(col, na.rm = T) #won't work long term... maybe chunk?
df_samesex_mm <- df_samesex_mm %>%
#    group_by(YEAR) %>% #I wonder if this is screwing things up
mutate(columned = total) %>%
rename(!!total_names[i] := columned) #%>% #seem to be running into an issue on RI I think grouping is the issue
#    ungroup()
}
df_samesex_mm <- fread("/Users/njrich/Desktop/Econ495/same-sex-migration/test_data.csv")
gc()
state_names <- unique(df_samesex_mm$state_name)
indv_names <- paste(state_names, "excluded_indv", sep = "_")
for(i in 1:length(state_names)) {
df_samesex_mm <- df_samesex_mm %>% #restrict this to gay earlier?
mutate(column = if_else(state_name != state_names[i], in_samesex_weighted, 0)) %>%
rename(!!indv_names[i] := column) #thank you chatgpt
}
total_names <- paste(state_names, "excluded_total", sep = "_")
for(i in 1:length(state_names)) {
col_name <- indv_names[i] #thank you data.frame
col <- df_samesex_mm[, ..col_name, drop = F]
#   total = sum(col, na.rm = T) #won't work long term... maybe chunk?
df_samesex_mm <- df_samesex_mm %>%
group_by(YEAR) %>% #I wonder if this is screwing things up
mutate(columned = sum(col)) %>%
rename(!!total_names[i] := columned) %>% #seem to be running into an issue on RI I think grouping is the issue
ungroup()
}
rm(list = ls())
#test making state level pop estimates including state var
df_samesex_mm <- fread("/Users/njrich/Desktop/Econ495/same-sex-migration/test_data.csv")
gc()
state_names <- unique(df_samesex_mm$state_name)
indv_names <- paste(state_names, "excluded_indv", sep = "_")
for(i in 1:length(state_names)) {
df_samesex_mm <- df_samesex_mm %>% #restrict this to gay earlier?
mutate(column = if_else(state_name != state_names[i], in_samesex_weighted, 0)) %>%
rename(!!indv_names[i] := column) #thank you chatgpt
}
total_names <- paste(state_names, "excluded_total", sep = "_")
for(i in 1:length(state_names)) {
col_name <- indv_names[i] #thank you data.frame
col <- df_samesex_mm[, ..col_name, drop = F]
total = sum(col, na.rm = T) #won't work long term... maybe chunk?
df_samesex_mm <- df_samesex_mm %>%
#    group_by(YEAR) %>% #I wonder if this is screwing things up
mutate(columned = sum(col)) %>%
rename(!!total_names[i] := columned) #%>% #seem to be running into an issue on RI I think grouping is the issue
#   ungroup()
}
View(df_samesex_mm)
years <- unique(df_samesex_mm$YEAR)
test <- indv_names[1]
df_samesex_mm[, ..test, drop = F]
distinct(indv_names)
unique(indv_names)
col_name <- indv_names[1] #thank you data.frame
col <- df_samesex_mm[, ..col_name, drop = F]
df_samesex_mm <- df_samesex_mm %>%
group_by(YEAR) %>% #THIS IS SCREWING THINGS UP but should work... test out of loop
mutate(columned = sum(col)) %>%
rename(!!total_names[1] := columned) %>%
ungroup()
df_samesex_mm <- fread("/Users/njrich/Desktop/Econ495/same-sex-migration/test_data.csv")
gc()
state_names <- unique(df_samesex_mm$state_name)
indv_names <- paste(state_names, "excluded_indv", sep = "_")
for(i in 1:length(state_names)) {
df_samesex_mm <- df_samesex_mm %>% #restrict this to gay earlier?
mutate(column = if_else(state_name != state_names[i], in_samesex_weighted, 0)) %>%
rename(!!indv_names[i] := column) #thank you chatgpt
}
#question: just use columns above and loop from very bottom? make separate data frames each time then merge?
total_names <- paste(state_names, "excluded_total", sep = "_")
col_name <- indv_names[1] #thank you data.frame
col <- df_samesex_mm[, ..col_name, drop = F]
df_samesex_mm <- df_samesex_mm %>%
group_by(YEAR) %>% #THIS IS SCREWING THINGS UP but should work... test out of loop
mutate(columned = sum(col)) %>%
ungroup()
rename(!!total_names[1] := columned)
col_name <- indv_names[1] #thank you data.frame
col <- df_samesex_mm[, ..col_name, drop = F]
col_name <- indv_names[1] #thank you data.frame
col <- df_samesex_mm[, ..col_name, drop = F]
rm(list = ls())
df_samesex_mm <- fread("/Users/njrich/Desktop/Econ495/same-sex-migration/test_data.csv")
gc()
state_names <- unique(df_samesex_mm$state_name)
indv_names <- paste(state_names, "excluded_indv", sep = "_")
for(i in 1:length(state_names)) {
df_samesex_mm <- df_samesex_mm %>% #restrict this to gay earlier?
mutate(column = if_else(state_name != state_names[i], in_samesex_weighted, 0)) %>%
rename(!!indv_names[i] := column) #thank you chatgpt
}
rm(list = ls())
gc()
df_samesex_mm <- fread("/Users/njrich/Desktop/Econ495/same-sex-migration/test_data.csv")
gc()
state_names <- unique(df_samesex_mm$state_name)
indv_names <- paste(state_names, "excluded_indv", sep = "_")
for(i in 1:length(state_names)) {
df_samesex_mm <- df_samesex_mm %>% #restrict this to gay earlier?
mutate(column = if_else(state_name != state_names[i], in_samesex_weighted, 0)) %>%
rename(!!indv_names[i] := column) #thank you chatgpt
}
total_names <- paste(state_names, "excluded_total", sep = "_")
col_name <- indv_names[1] #thank you data.frame
col <- df_samesex_mm[, ..col_name, drop = F]
df_samesex_mm <- df_samesex_mm %>%
group_by(YEAR) %>% #THIS IS SCREWING THINGS UP but should work... test out of loop
mutate(columned = sum(col)) %>%
ungroup() %>%
rename(!!total_names[1] := columned)
rm(list = ls())
gc()
df_samesex_mm <- fread("/Users/njrich/Desktop/Econ495/same-sex-migration/test_data.csv")
gc()
state_names <- unique(df_samesex_mm$state_name)
indv_names <- paste(state_names, "excluded_indv", sep = "_")
for(i in 1:length(state_names)) {
df_samesex_mm <- df_samesex_mm %>% #restrict this to gay earlier?
mutate(column = if_else(state_name != state_names[i], in_samesex_weighted, 0)) %>%
rename(!!indv_names[i] := column) #thank you chatgpt
}
total_names <- paste(state_names, "excluded_total", sep = "_")
for(i in 1:length(state_names)) {
col_name <- indv_names[i] #thank you data.frame
col <- df_samesex_mm[, ..col_name, drop = F]
df_samesex_mm <- df_samesex_mm %>%
group_by(YEAR) %>% #THIS IS SCREWING THINGS UP but should work... test out of loop
mutate(columned = sum(col)) %>%
ungroup() %>%
rename(!!total_names[i] := columned)
}
col_name <- indv_names[1] #thank you data.frame
col <- df_samesex_mm[, ..col_name, drop = F]
rm(list = ls())
df_samesex_mm <- fread("/Users/njrich/Desktop/Econ495/same-sex-migration/test_data.csv")
gc()
state_names <- unique(df_samesex_mm$state_name)
indv_names <- paste(state_names, "excluded_indv", sep = "_")
for(i in 1:length(state_names)) {
df_samesex_mm <- df_samesex_mm %>% #restrict this to gay earlier?
mutate(column = if_else(state_name != state_names[i], in_samesex_weighted, 0)) %>%
rename(!!indv_names[i] := column) #thank you chatgpt
}
total_names <- paste(state_names, "excluded_total", sep = "_")
col_name <- indv_names[1] #thank you data.frame
col <- df_samesex_mm[, ..col_name, drop = F]
df_samesex_mm <- df_samesex_mm %>%
group_by(YEAR) %>% #THIS IS SCREWING THINGS UP but should work... test out of loop
mutate(columned = sum(col)) %>%
ungroup() %>%
rename(!!total_names[1] := columned)
View(df_samesex_mm)
col_name <- indv_names[1] #thank you data.frame
col <- df_samesex_mm[, ..col_name, drop = F]
rm(list= ls())
col_name <- indv_names[1] #thank you data.frame
#test making state level pop estimates including state var
df_samesex_mm <- fread("/Users/njrich/Desktop/Econ495/same-sex-migration/test_data.csv")
gc()
state_names <- unique(df_samesex_mm$state_name)
indv_names <- paste(state_names, "excluded_indv", sep = "_")
for(i in 1:length(state_names)) {
df_samesex_mm <- df_samesex_mm %>% #restrict this to gay earlier?
mutate(column = if_else(state_name != state_names[i], in_samesex_weighted, 0)) %>%
rename(!!indv_names[i] := column) #thank you chatgpt
}
total_names <- paste(state_names, "excluded_total", sep = "_")
col_name <- indv_names[1] #thank you data.frame
col <- df_samesex_mm[, ..col_name, drop = F]
col_name <- indv_names[1] #thank you data.frame
#col <- df_samesex_mm[, ..col_name, drop = F] #Now this is what doesn't work find alternate way
df_samesex_mm <- df_samesex_mm %>%
group_by(YEAR) %>% #THIS IS SCREWING THINGS UP but should work... test out of loop
mutate(columned = sum(col_name)) %>% #hmm not compatible bc not getting act column
ungroup() %>%
rename(!!total_names[1] := columned)
col_name <- indv_names[1] #thank you data.frame
#col <- df_samesex_mm[, ..col_name, drop = F] #Now this is what doesn't work find alternate way
df_samesex_mm <- df_samesex_mm %>%
group_by(YEAR) %>% #THIS IS SCREWING THINGS UP but should work... test out of loop
mutate(columned = sum({{ col_name }})) %>% #hmm not compatible bc not getting act column
ungroup() %>%
rename(!!total_names[1] := columned)
rm(list = ls())
gc()
#test making state level pop estimates including state var
df_samesex_mm <- fread("/Users/njrich/Desktop/Econ495/same-sex-migration/test_data.csv")
gc()
state_names <- unique(df_samesex_mm$state_name)
indv_names <- paste(state_names, "excluded_indv", sep = "_")
for(i in 1:length(state_names)) {
df_samesex_mm <- df_samesex_mm %>% #restrict this to gay earlier?
mutate(column = if_else(state_name != state_names[i], in_samesex_weighted, 0)) %>%
rename(!!indv_names[i] := column) #thank you chatgpt
}
total_names <- paste(state_names, "excluded_total", sep = "_")
col_name <- indv_names[1] #thank you data.frame
df_samesex_mm <- df_samesex_mm %>%
group_by(YEAR) %>% #THIS IS SCREWING THINGS UP but should work... test out of loop
mutate(columned = sum({{ col_name }})) #hmm not compatible bc not getting act column
?sm
?sym
col_name <- indv_names[1] #thank you data.frame
df_samesex_mm <- df_samesex_mm %>%
group_by(YEAR) %>% #THIS IS SCREWING THINGS UP but should work... test out of loop
mutate(columned = sum({{ sym(col_name) }})) #hmm not compatible bc not getting act column
col_name <- indv_names[1] #thank you data.frame
df_samesex_mm <- df_samesex_mm %>%
group_by(YEAR) %>% #THIS IS SCREWING THINGS UP but should work... test out of loop
mutate(columned = sum({{ !!col_name }})) #hmm not compatible bc not getting act column
col_name <- indv_names[1] #thank you data.frame
df_samesex_mm <- df_samesex_mm %>%
group_by(YEAR) %>% #THIS IS SCREWING THINGS UP but should work... test out of loop
mutate(columned = sum({{ !!sym(col_name) }})) #hmm not compatible bc not getting act column
col_name <- indv_names[1] #thank you data.frame
df_samesex_mm <- df_samesex_mm %>%
group_by(YEAR) %>% #THIS IS SCREWING THINGS UP but should work... test out of loop
mutate(columned = sum({{ !!sym(col_name) }})) %>% #hmm not compatible bc not getting act column
ungroup() %>%
rename(!!total_names[1] := columned)
col_name <- indv_names[1] #thank you data.frame
df_samesex_mm <- df_samesex_mm %>%
group_by(YEAR) %>% #THIS IS SCREWING THINGS UP but should work... test out of loop
mutate(columned = sum(!!sym(col_name))) %>% %>% #hmm not compatible bc not getting act column
col_name <- indv_names[1] #thank you data.frame
df_samesex_mm <- df_samesex_mm %>%
group_by(YEAR) %>% #THIS IS SCREWING THINGS UP but should work... test out of loop
mutate(columned = sum(!!sym(col_name))) %>% #hmm not compatible bc not getting act column
ungroup() %>%
rename(!!total_names[1] := columned)
View(df_samesex_mm)
rm(list = ls())
gc()
#test making state level pop estimates including state var
df_samesex_mm <- fread("/Users/njrich/Desktop/Econ495/same-sex-migration/test_data.csv")
gc()
state_names <- unique(df_samesex_mm$state_name)
indv_names <- paste(state_names, "excluded_indv", sep = "_")
for(i in 1:length(state_names)) {
df_samesex_mm <- df_samesex_mm %>% #restrict this to gay earlier?
mutate(column = if_else(state_name != state_names[i], in_samesex_weighted, 0)) %>%
rename(!!indv_names[i] := column) #thank you chatgpt
}
total_names <- paste(state_names, "excluded_total", sep = "_")
for(i in 1:length(state_names)) {
col_name <- indv_names[i] #thank you data.frame
col <- df_samesex_mm[, ..col_name, drop = F]
df_samesex_mm <- df_samesex_mm %>%
group_by(YEAR) %>%
mutate(columned = sum(!!sym(col_name))) %>% #this seems to work oi thanks chatgpt
ungroup() %>%
rename(!!total_names[i] := columned)
}
#test making state level pop estimates including state var
df_samesex_mm <- fread("/Users/njrich/Desktop/Econ495/same-sex-migration/test_data.csv")
gc()
state_names <- unique(df_samesex_mm$state_name)
indv_names <- paste(state_names, "excluded_indv", sep = "_")
for(i in 1:length(state_names)) {
df_samesex_mm <- df_samesex_mm %>% #restrict this to gay earlier?
mutate(column = if_else(state_name != state_names[i], in_samesex_weighted, 0)) %>%
rename(!!indv_names[i] := column) #thank you chatgpt
}
total_names <- paste(state_names, "excluded_total", sep = "_")
for(i in 1:length(state_names)) {
col_name <- indv_names[i] #thank you data.frame
df_samesex_mm <- df_samesex_mm %>%
group_by(YEAR) %>%
mutate(columned = sum(!!sym(col_name))) %>% #this seems to work oi thanks chatgpt
ungroup() %>%
rename(!!total_names[i] := columned)
}
?!!
