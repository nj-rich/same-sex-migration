<<<<<<< HEAD
scale_x_continuous(breaks = 2011:2019) +
theme_apa() #can always go back to theme
post_migrant_trends_chart
?scale_shape_manual
?scale_linetype_manual
gc()
ante_migrant_trends_chart <- ante_migrant_trends_df %>%
mutate(year = factor(year)) %>%
ggplot() +
geom_point(aes(x = year, y = frac_migrate, linetype = subgroup, color = subgroup)) +
labs(title = "Ex-Ante Triple Regression Visualized",
y = "Fraction Migrated",
color = "Subgroup") +
geom_vline(xintercept = factor(2015), color = "black", linetype = "dashed") + #bc factor issues
scale_color_manual(values = c("samesex_oldlegal" = "#EECC66", "oppositesex_oldlegal" = "#EE99AA", "samesex_newlegal" = "#6699CC", "oppositesex_newlegal" = "#997700"),
labels = c("samesex_oldlegal" = "Same-Sex Individuals in Locally Legalized States", "oppositesex_oldlegal" = "Opposite-Sex Individuals in Locally Legalized States", "samesex_newlegal" = "Same-Sex Individuals in Federally Legalized States", "oppositesex_newlegal" = "Opposite-Sex Individuals in Federally Legalized States")) +
theme_apa()
gc()
post_migrant_trends_chart <- post_migrant_trends_df %>%
ggplot() +
geom_line(aes(x = year, y = frac_migrate, color = subgroup)) + #linetype = subgroup,
labs(title = "Ex-Post Triple Regression Visualized",
y = "Fraction Migrated",
color = "Subgroup") + #maybe move title to plot itself
=======
labs(title = "From Local Legalized Trends Visualized",
x = "Year",
y = "Fraction Migrated",
linetype = "Subgroup") + #maybe move title to plot itself
>>>>>>> 1f0e89786611c4bc360668b44ee0ae480b8e2868
geom_vline(xintercept = 2015, color = "black", linetype = "dashed") + #bc factor issues
scale_linetype_manual(values = c("samesex_oldlegal" = "solid", "oppositesex_oldlegal" = "dotted", "samesex_newlegal" = "longdash", "oppositesex_newlegal" = "dotdash"),
labels = c("samesex_oldlegal" = "Same-Sex Individuals in Locally Legalized States", "oppositesex_oldlegal" = "Opposite-Sex Individuals in Locally Legalized States", "samesex_newlegal" = "Same-Sex Individuals in Federally Legalized States", "oppositesex_newlegal" = "Opposite-Sex Individuals in Federally Legalized States")) +
scale_x_continuous(breaks = 2011:2019) +
theme_apa() #can always go back to theme
#watch diffs v general flows oi vey
#oop functionalize
from_local
colnames(clean_df)
from_local <- summary_stats %>%
filter(exante_old_legal == 1) %>%
group_by(year, in_samesex) %>%
summarize(frac_to_diff_local = survey_mean(localtolocal_migrant, na.rm = T),
frac_to_fed = survey_mean(localtofed_migrant, na.rm = T),
frac_stay = 1- survey_mean(migrant, na.rm = T)) %>% #watch how filtering impacts mean-ing here
select(-frac_migrate_se) %>%
ungroup()
from_local <- summary_stats %>%
filter(exante_old_legal == 1) %>%
group_by(year, in_samesex) %>%
summarize(frac_to_diff_local = survey_mean(localtolocal_migrant, na.rm = T),
frac_to_fed = survey_mean(localtofed_migrant, na.rm = T),
frac_stay = 1 - survey_mean(migrant, na.rm = T)) %>% #watch how filtering impacts mean-ing here
select(-frac_to_diff_local_se, -frac_to_fed_se, frac_stay_se) %>%
ungroup()
?pivot_longer
gc()
#from local same-sex sample
from_local <- summary_stats %>%
filter(exante_old_legal == 1) %>%
group_by(year, in_samesex) %>%
summarize(frac_to_diff_local = survey_mean(localtolocal_migrant, na.rm = T),
frac_to_fed = survey_mean(localtofed_migrant, na.rm = T),
frac_stay = 1 - survey_mean(migrant, na.rm = T)) %>% #watch how filtering impacts mean-ing here
select(-frac_to_diff_local_se, -frac_to_fed_se, frac_stay_se) %>%
ungroup() %>%
pivot_longer(frac_to_diff_local:frac_stay, names_to = "category", values_to = "values") %>%
ggplot() +
geom_line(aes(x = year, y = values, linetype = in_samesex)) +
labs(title = "From Local Legalized Trends Visualized",
x = "Year",
y = "Fraction of Rel. Population",
linetype = "Relationship Type") + #maybe move title to plot itself
geom_vline(xintercept = 2015, color = "black", linetype = "dashed") + #bc factor issues
scale_linetype_manual(values = c(1 = "solid", 2 = "dotted"),
from_local <- summary_stats %>%
filter(exante_old_legal == 1) %>%
group_by(year, in_samesex) %>%
summarize(frac_to_diff_local = survey_mean(localtolocal_migrant, na.rm = T),
frac_to_fed = survey_mean(localtofed_migrant, na.rm = T),
frac_stay = 1 - survey_mean(migrant, na.rm = T)) %>% #watch how filtering impacts mean-ing here
select(-frac_to_diff_local_se, -frac_to_fed_se, frac_stay_se) %>%
ungroup() %>%
pivot_longer(frac_to_diff_local:frac_stay, names_to = "category", values_to = "values")
View(from_local)
glimpse(from_local)
from_local <- summary_stats %>%
filter(exante_old_legal == 1) %>%
group_by(year, in_samesex) %>%
summarize(frac_to_diff_local = survey_mean(localtolocal_migrant, na.rm = T),
frac_to_fed = survey_mean(localtofed_migrant, na.rm = T),
frac_stay = 1 - survey_mean(migrant, na.rm = T)) %>% #watch how filtering impacts mean-ing here
select(-frac_to_diff_local_se, -frac_to_fed_se, -frac_stay_se) %>%
ungroup() %>%
pivot_longer(frac_to_diff_local:frac_stay, names_to = "category", values_to = "values")
View(from_local)
gc()
#from locally legalized same-sex sample
from_local <- summary_stats %>%
filter(exante_old_legal == 1) %>%
group_by(year, in_samesex) %>%
summarize(frac_to_diff_local = survey_mean(localtolocal_migrant, na.rm = T),
frac_to_fed = survey_mean(localtofed_migrant, na.rm = T),
frac_stay = 1 - survey_mean(migrant, na.rm = T)) %>% #watch how filtering impacts mean-ing here
select(-frac_to_diff_local_se, -frac_to_fed_se, -frac_stay_se) %>%
ungroup() %>%
pivot_longer(frac_to_diff_local:frac_stay, names_to = "category", values_to = "values") %>%
ggplot() +
geom_line(aes(x = year, y = values, linetype = in_samesex)) +
labs(title = "From Local Legalized Trends Visualized",
x = "Year",
y = "Fraction of Rel. Population",
linetype = "Relationship Type") + #maybe move title to plot itself
geom_vline(xintercept = 2015, color = "black", linetype = "dashed") + #bc factor issues
scale_linetype_manual(values = c(1 = "solid", 2 = "dotted"),
gc()
#from locally legalized same-sex sample
from_local <- summary_stats %>%
filter(exante_old_legal == 1) %>%
group_by(year, in_samesex) %>%
summarize(frac_to_diff_local = survey_mean(localtolocal_migrant, na.rm = T),
frac_to_fed = survey_mean(localtofed_migrant, na.rm = T),
frac_stay = 1 - survey_mean(migrant, na.rm = T)) %>% #watch how filtering impacts mean-ing here
select(-frac_to_diff_local_se, -frac_to_fed_se, -frac_stay_se) %>%
ungroup() %>%
pivot_longer(frac_to_diff_local:frac_stay, names_to = "category", values_to = "values") %>%
ggplot() +
geom_line(aes(x = year, y = values, linetype = in_samesex)) +
labs(title = "From Local Legalized Trends Visualized",
x = "Year",
y = "Fraction of Rel. Population",
linetype = "Relationship Type") + #maybe move title to plot itself
geom_vline(xintercept = 2015, color = "black", linetype = "dashed") + #bc factor issues
scale_linetype_manual(values = c("1" = "solid", "2" = "dotted"),
labels = c("1" = "In Same-Sex Relationship", "2" = "In Opposite-Sex Relationship")) +
scale_x_continuous(breaks = 2011:2019) +
facet_wrap(~ category) +
theme_apa() #can always go back to theme
#watch diffs v general flows oi vey
#oop functionalize
#watch change in meaning of outcome variables when splitting things up
#watch diff btwn local to local migrant v stay in state
#oi watch how do this in a regression
#just break in two and look at migration rates?
#is staying the same moving to a state of the same type
#lol make sure numbers add up to 1
from_local
?as.character
gc()
#from locally legalized same-sex sample
from_local <- summary_stats %>%
filter(exante_old_legal == 1) %>%
group_by(year, in_samesex) %>%
summarize(frac_to_diff_local = survey_mean(localtolocal_migrant, na.rm = T),
frac_to_fed = survey_mean(localtofed_migrant, na.rm = T),
frac_stay = 1 - survey_mean(migrant, na.rm = T)) %>% #watch how filtering impacts mean-ing here
select(-frac_to_diff_local_se, -frac_to_fed_se, -frac_stay_se) %>%
mutate(samesex_group = as.character(in_samesex)) %>%
ungroup() %>%
pivot_longer(frac_to_diff_local:frac_stay, names_to = "category", values_to = "values") %>%
ggplot() +
geom_line(aes(x = year, y = values, linetype = samesex_group)) +
labs(title = "From Local Legalized Trends Visualized",
x = "Year",
y = "Fraction of Rel. Population",
linetype = "Relationship Type") + #maybe move title to plot itself
geom_vline(xintercept = 2015, color = "black", linetype = "dashed") + #bc factor issues
scale_linetype_manual(values = c("1" = "solid", "2" = "dotted"),
labels = c("1" = "In Same-Sex Relationship", "2" = "In Opposite-Sex Relationship")) +
scale_x_continuous(breaks = 2011:2019) +
facet_wrap(~ category) +
theme_apa() #can always go back to theme
#watch diffs v general flows oi vey
#oop functionalize
#watch change in meaning of outcome variables when splitting things up
#watch diff btwn local to local migrant v stay in state
#oi watch how do this in a regression
#just break in two and look at migration rates?
#is staying the same moving to a state of the same type
#lol make sure numbers add up to 1
from_local
gc()
#from locally legalized same-sex sample
from_local <- summary_stats %>%
filter(exante_old_legal == 1) %>%
group_by(year, in_samesex) %>%
summarize(frac_to_diff_local = survey_mean(localtolocal_migrant, na.rm = T),
frac_to_fed = survey_mean(localtofed_migrant, na.rm = T),
frac_stay = 1 - survey_mean(migrant, na.rm = T)) %>% #watch how filtering impacts mean-ing here
select(-frac_to_diff_local_se, -frac_to_fed_se, -frac_stay_se) %>%
mutate(samesex_group = if_else(in_samesex == 1, "same_sex", "opposite_sex")) %>%
ungroup() %>%
pivot_longer(frac_to_diff_local:frac_stay, names_to = "category", values_to = "values") %>%
ggplot() +
geom_line(aes(x = year, y = values, linetype = samesex_group)) +
labs(title = "From Locally Legalized Trends Visualized",
x = "Year",
y = "Fraction of Rel. Population",
linetype = "Relationship Type") + #maybe move title to plot itself
geom_vline(xintercept = 2015, color = "black", linetype = "dashed") + #bc factor issues
scale_linetype_manual(values = c("same_sex" = "solid", "opposite_sex" = "dotted"),
labels = c("sane_sex" = "In Same-Sex Relationship", "opposite_sex" = "In Opposite-Sex Relationship")) +
scale_x_continuous(breaks = 2011:2019) +
facet_wrap(~ category) +
theme_apa() #can always go back to theme
#watch diffs v general flows oi vey
#oop functionalize
#watch change in meaning of outcome variables when splitting things up
#watch diff btwn local to local migrant v stay in state
#oi watch how do this in a regression
#just break in two and look at migration rates?
#is staying the same moving to a state of the same type
#lol make sure numbers add up to 1
from_local
?facet_wrap
gc()
#from locally legalized same-sex sample
from_local <- summary_stats %>%
filter(exante_old_legal == 1) %>%
group_by(year, in_samesex) %>%
summarize(frac_to_diff_local = survey_mean(localtolocal_migrant, na.rm = T),
frac_to_fed = survey_mean(localtofed_migrant, na.rm = T),
frac_stay = 1 - survey_mean(migrant, na.rm = T)) %>% #watch how filtering impacts mean-ing here
select(-frac_to_diff_local_se, -frac_to_fed_se, -frac_stay_se) %>%
mutate(samesex_group = if_else(in_samesex == 1, "same_sex", "opposite_sex")) %>%
ungroup() %>%
pivot_longer(frac_to_diff_local:frac_stay, names_to = "category", values_to = "values") %>%
ggplot() +
geom_line(aes(x = year, y = values, linetype = samesex_group)) +
labs(title = "From Locally Legalized Trends Visualized",
x = "Year",
y = "Fraction of Population",
linetype = "Relationship Type") + #maybe move title to plot itself
geom_vline(xintercept = 2015, color = "black", linetype = "dashed") + #bc factor issues
scale_linetype_manual(values = c("same_sex" = "solid", "opposite_sex" = "dashed"),
labels = c("sane_sex" = "In Same-Sex Relationship", "opposite_sex" = "In Opposite-Sex Relationship")) +
scale_x_continuous(breaks = 2011:2019) +
facet_wrap(~ category, labeller = as_labeller("frac_to_diff_local" = "To Other Locally Legalized State", "frac_to_fed_local" = "To Not Yet Or Federally Legalized State", "frac_stayed" = "To Same State")) +
theme_apa() #can always go back to theme
gc()
#from locally legalized same-sex sample
from_local <- summary_stats %>%
filter(exante_old_legal == 1) %>%
group_by(year, in_samesex) %>%
summarize(frac_to_diff_local = survey_mean(localtolocal_migrant, na.rm = T),
frac_to_fed = survey_mean(localtofed_migrant, na.rm = T),
frac_stay = 1 - survey_mean(migrant, na.rm = T)) %>% #watch how filtering impacts mean-ing here
select(-frac_to_diff_local_se, -frac_to_fed_se, -frac_stay_se) %>%
mutate(samesex_group = if_else(in_samesex == 1, "same_sex", "opposite_sex")) %>%
ungroup() %>%
pivot_longer(frac_to_diff_local:frac_stay, names_to = "category", values_to = "values") %>%
ggplot() +
geom_line(aes(x = year, y = values, linetype = samesex_group)) +
labs(title = "From Locally Legalized Trends Visualized",
x = "Year",
y = "Fraction of Population",
linetype = "Relationship Type") + #maybe move title to plot itself
geom_vline(xintercept = 2015, color = "black", linetype = "dashed") + #bc factor issues
scale_linetype_manual(values = c("same_sex" = "solid", "opposite_sex" = "dashed"),
labels = c("sane_sex" = "In Same-Sex Relationship", "opposite_sex" = "In Opposite-Sex Relationship")) +
scale_x_continuous(breaks = 2011:2019) +
facet_wrap(~ category, labeller = as_labeller(c("frac_to_diff_local" = "To Other Locally Legalized State", "frac_to_fed_local" = "To Not Yet Or Federally Legalized State", "frac_stayed" = "To Same State"))) +
theme_apa() #can always go back to theme
#watch diffs v general flows oi vey
#oop functionalize
#watch change in meaning of outcome variables when splitting things up
#watch diff btwn local to local migrant v stay in state
#oi watch how do this in a regression
#just break in two and look at migration rates?
#is staying the same moving to a state of the same type
#lol make sure numbers add up to 1
#oop dashed v dotted
#WATCH DEFINITIONS FEDERALLY LEGALIZED A BIT AMBIGUOUS
#oopsy efficiencies
from_local
gc()
#from locally legalized same-sex sample
from_local_trends_df <- summary_stats %>%
filter(exante_old_legal == 1) %>%
group_by(year, in_samesex) %>%
summarize(frac_to_diff_local = survey_mean(localtolocal_migrant, na.rm = T),
frac_to_fed = survey_mean(localtofed_migrant, na.rm = T),
frac_stay = 1 - survey_mean(migrant, na.rm = T)) %>% #watch how filtering impacts mean-ing here
select(-frac_to_diff_local_se, -frac_to_fed_se, -frac_stay_se) %>%
mutate(samesex_group = if_else(in_samesex == 1, "same_sex", "opposite_sex")) %>%
ungroup() %>%
pivot_longer(frac_to_diff_local:frac_stay, names_to = "category", values_to = "values") %>%
from_local_trends_chart <- from_local_trends_df %>%
ggplot() +
geom_line(aes(x = year, y = values, linetype = samesex_group)) +
labs(title = "From Locally Legalized Trends Visualized",
x = "Year",
y = "Fraction of Population",
linetype = "Relationship Type") + #maybe move title to plot itself
geom_vline(xintercept = 2015, color = "black", linetype = "dashed") + #bc factor issues
scale_linetype_manual(values = c("same_sex" = "solid", "opposite_sex" = "dashed"),
labels = c("sane_sex" = "In Same-Sex Relationship", "opposite_sex" = "In Opposite-Sex Relationship")) +
scale_x_continuous(breaks = 2011:2019) +
facet_wrap(~ category, labeller = as_labeller(c("frac_to_diff_local" = "To Other Locally Legalized State", "frac_to_fed_local" = "To Not/Fed Legalized State", "frac_stayed" = "To Same State"))) +
theme_apa() #can always go back to theme
gc()
#from locally legalized same-sex sample
from_local_trends_df <- summary_stats %>%
filter(exante_old_legal == 1) %>%
group_by(year, in_samesex) %>%
summarize(frac_to_diff_local = survey_mean(localtolocal_migrant, na.rm = T),
frac_to_fed = survey_mean(localtofed_migrant, na.rm = T),
frac_stay = 1 - survey_mean(migrant, na.rm = T)) %>% #watch how filtering impacts mean-ing here
select(-frac_to_diff_local_se, -frac_to_fed_se, -frac_stay_se) %>%
mutate(samesex_group = if_else(in_samesex == 1, "same_sex", "opposite_sex")) %>%
ungroup() %>%
pivot_longer(frac_to_diff_local:frac_stay, names_to = "category", values_to = "values") %>%
from_local_trends_chart <- from_local_trends_df %>%
ggplot() +
geom_line(aes(x = year, y = values, linetype = samesex_group)) +
labs(title = "From Locally Legalized Trends Visualized",
x = "Year",
y = "Fraction of Population",
linetype = "Relationship Type") + #maybe move title to plot itself
geom_vline(xintercept = 2015, color = "black", linetype = "dashed") + #bc factor issues
scale_linetype_manual(values = c("same_sex" = "solid", "opposite_sex" = "dashed"),
labels = c("sane_sex" = "In Same-Sex Relationship", "opposite_sex" = "In Opposite-Sex Relationship")) +
scale_x_continuous(breaks = 2011:2019) +
facet_wrap(~ category, labeller = as_labeller(c("frac_to_diff_local" = "To Other Locally Legalized State", "frac_to_fed_local" = "To Not/Fed Legalized State", "frac_stayed" = "To Same State"))) +
theme_apa() #can always go back to theme
gc()
#from locally legalized same-sex sample
from_local_trends_df <- summary_stats %>%
filter(exante_old_legal == 1) %>%
group_by(year, in_samesex) %>%
summarize(frac_to_diff_local = survey_mean(localtolocal_migrant, na.rm = T),
frac_to_fed = survey_mean(localtofed_migrant, na.rm = T),
frac_stay = 1 - survey_mean(migrant, na.rm = T)) %>% #watch how filtering impacts mean-ing here
select(-frac_to_diff_local_se, -frac_to_fed_se, -frac_stay_se) %>%
mutate(samesex_group = if_else(in_samesex == 1, "same_sex", "opposite_sex")) %>%
ungroup() %>%
pivot_longer(frac_to_diff_local:frac_stay, names_to = "category", values_to = "values")
from_local_trends_chart <- from_local_trends_df %>%
ggplot() +
geom_line(aes(x = year, y = values, linetype = samesex_group)) +
labs(title = "From Locally Legalized Trends Visualized",
x = "Year",
y = "Fraction of Population",
linetype = "Relationship Type") + #maybe move title to plot itself
geom_vline(xintercept = 2015, color = "black", linetype = "dashed") + #bc factor issues
scale_linetype_manual(values = c("same_sex" = "solid", "opposite_sex" = "dashed"),
labels = c("sane_sex" = "In Same-Sex Relationship", "opposite_sex" = "In Opposite-Sex Relationship")) +
scale_x_continuous(breaks = 2011:2019) +
facet_wrap(~ category, labeller = as_labeller(c("frac_to_diff_local" = "To Other Locally Legalized State", "frac_to_fed_local" = "To Not/Fed Legalized State", "frac_stayed" = "To Same State"))) +
theme_apa() #can always go back to theme
#watch diffs v general flows oi vey
#oop functionalize
#watch change in meaning of outcome variables when splitting things up
#watch diff btwn local to local migrant v stay in state
#oi watch how do this in a regression
#just break in two and look at migration rates?
#is staying the same moving to a state of the same type
#lol make sure numbers add up to 1
#oop dashed v dotted
#WATCH DEFINITIONS FEDERALLY LEGALIZED A BIT AMBIGUOUS
#oopsy efficiencies
#sigh moving slowly
from_local_trends_chart
from_local_trends_chart <- from_local_trends_df %>%
ggplot() +
geom_line(aes(x = year, y = values, linetype = samesex_group)) +
labs(title = "From Locally Legalized Trends Visualized",
x = "Year",
y = "Fraction of Population",
linetype = "Relationship Type") + #maybe move title to plot itself
geom_vline(xintercept = 2015, color = "black", linetype = "dashed") + #bc factor issues
scale_linetype_manual(values = c("same_sex" = "solid", "opposite_sex" = "dashed"),
labels = c("same_sex" = "In Same-Sex Relationship", "opposite_sex" = "In Opposite-Sex Relationship")) +
scale_x_continuous(breaks = 2011:2019) +
facet_wrap(~ category, labeller = as_labeller(c("frac_to_diff_local" = "To Other Locally Legalized State", "frac_to_fed" = "To Not/Fed Legalized State", "frac_stay" = "To Same State"))) +
theme_apa() #can always go back to theme
from_local_trends_chart
from_local_df <- summary_stats %>%
filter(exante_old_legal == 1) %>%
group_by(year, in_samesex) %>%
summarize(frac_to_diff_local = survey_mean(localtolocal_migrant, na.rm = T),
frac_to_fed = survey_mean(localtofed_migrant, na.rm = T),
frac_stay = 1 - survey_mean(migrant, na.rm = T)) %>% #watch how filtering impacts mean-ing here
select(-frac_to_diff_local_se, -frac_to_fed_se, -frac_stay_se) %>%
mutate(samesex_group = if_else(in_samesex == 1, "same_sex", "opposite_sex")) %>%
ungroup()
View(from_local_df)
?pivot_wider
from_local_diffs_chart <- from_local_df %>%
pivot_longer(frac_to_diff_local:frac_stay, names_to = "category", values_to = "values") %>%
pivot_wider(values, names_from = "samesex_group")
from_local_diffs_chart <- from_local_df %>%
pivot_longer(frac_to_diff_local:frac_stay, names_to = "category", values_to = "values") %>%
pivot_wider(names_from = samesex_group, values_from = values)
from_local_diffs_chart <- from_local_df %>%
pivot_longer(frac_to_diff_local:frac_stay, names_to = "category", values_to = "values") %>%
pivot_wider(names_from = samesex_group, values_from = values) %>%
mutate(ss_os = same_sex - opposite_sex) %>%
ggplot() +
geom_line(aes(x = year, y = ss_os)) +
labs(title = "From Locally Legalized Trends Visualized",
x = "Year",
y = "Fraction Same-Sex - Opposite-Sex") + #NOTE HOW THIS INTERPRETATION LINES UP WITH ABOVE INTERPRETATION OOPS- actually might be good just take it another step further
geom_vline(xintercept = 2015, color = "black", linetype = "dashed") +
scale_x_continuous(breaks = 2011:2019) +
facet_wrap(~ category, labeller = as_labeller(c("frac_to_diff_local" = "To Other Locally Legalized State", "frac_to_fed" = "To Not/Fed Legalized State", "frac_stay" = "To Same State"))) +
theme_apa() #can always go back to theme
from_local_diffs_chart
from_local_diffs_chart <- from_local_df %>%
pivot_longer(frac_to_diff_local:frac_stay, names_to = "category", values_to = "values") %>%
pivot_wider(names_from = samesex_group, values_from = values)
View(from_local_diffs_chart)
from_local_diffs_chart <- from_local_df %>%
pivot_longer(frac_to_diff_local:frac_stay, names_to = "category", values_to = "values")
View(from_local_diffs_chart)
?pivot_wider
from_local_diffs_chart <- from_local_df %>%
pivot_longer(frac_to_diff_local:frac_stay, names_to = "category", values_to = "values") %>%
pivot_wider(names_from = samesex_group, values_from = values)
View(from_local_diffs_chart)
from_local_diffs_chart <- from_local_df %>%
pivot_longer(frac_to_diff_local:frac_stay, names_to = "category", values_to = "values") %>%
select(-in_same_sex) %>%
pivot_wider(names_from = samesex_group, values_from = values)
from_local_diffs_chart <- from_local_df %>%
pivot_longer(frac_to_diff_local:frac_stay, names_to = "category", values_to = "values")
View(from_local_diffs_chart)
from_local_diffs_chart <- from_local_df %>%
pivot_longer(frac_to_diff_local:frac_stay, names_to = "category", values_to = "values") %>%
select(-in_samesex) %>%
pivot_wider(names_from = samesex_group, values_from = values)
View(from_local_diffs_chart)
from_local_diffs_chart <- from_local_df %>%
pivot_longer(frac_to_diff_local:frac_stay, names_to = "category", values_to = "values") %>%
select(-in_samesex) %>%
pivot_wider(names_from = samesex_group, values_from = values) %>%
mutate(ss_os = same_sex - opposite_sex) %>%
ggplot() +
geom_line(aes(x = year, y = ss_os)) +
labs(title = "From Locally Legalized Trends Visualized",
x = "Year",
y = "Fraction Same-Sex - Opposite-Sex") + #NOTE HOW THIS INTERPRETATION LINES UP WITH ABOVE INTERPRETATION OOPS- actually might be good just take it another step further
geom_vline(xintercept = 2015, color = "black", linetype = "dashed") +
scale_x_continuous(breaks = 2011:2019) +
facet_wrap(~ category, labeller = as_labeller(c("frac_to_diff_local" = "To Other Locally Legalized State", "frac_to_fed" = "To Not/Fed Legalized State", "frac_stay" = "To Same State"))) +
theme_apa() #can always go back to theme
from_local_diffs_chart
from_fed_df <- summary_stats %>%
filter(exante_old_legal == 0) %>%
group_by(year, in_samesex) %>%
summarize(frac_to_diff_fed = survey_mean(fedtofed_migrant, na.rm = T),
frac_to_local = survey_mean(fedtolocal_migrant, na.rm = T),
frac_stay = 1 - survey_mean(migrant, na.rm = T)) %>% #watch how filtering impacts mean-ing here
select(-frac_to_diff_fed_se, -frac_to_local_se, -frac_stay_se) %>%
mutate(samesex_group = if_else(in_samesex == 1, "same_sex", "opposite_sex")) %>%
ungroup()
from_fed_trends_chart <- from_fed_df %>%
pivot_longer(frac_to_diff_fed:frac_stay, names_to = "category", values_to = "values") %>%
ggplot() +
geom_line(aes(x = year, y = values, linetype = samesex_group)) +
labs(title = "From Not/Federally Legalized Trends Visualized",
x = "Year",
y = "Fraction of Population",
linetype = "Relationship Type") + #maybe move title to plot itself
geom_vline(xintercept = 2015, color = "black", linetype = "dashed") +
scale_linetype_manual(values = c("same_sex" = "solid", "opposite_sex" = "dashed"),
labels = c("same_sex" = "In Same-Sex Relationship", "opposite_sex" = "In Opposite-Sex Relationship")) +
scale_x_continuous(breaks = 2011:2019) +
facet_wrap(~ category, labeller = as_labeller(c("frac_to_diff_fed" = "To Other Not/Federally Legalized State", "frac_to_local" = "To Locally Legalized State", "frac_stay" = "To Same State"))) +
theme_apa() #can always go back to theme
from_fed_diffs_chart <- from_fed_df %>%
pivot_longer(frac_to_diff_fed:frac_stay, names_to = "category", values_to = "values") %>%
select(-in_samesex) %>%
pivot_wider(names_from = samesex_group, values_from = values) %>%
mutate(ss_os = same_sex - opposite_sex) %>%
ggplot() +
geom_line(aes(x = year, y = ss_os)) +
labs(title = "From Not/Federally Legalized Diffs Visualized",
x = "Year",
y = "Fraction Same-Sex - Opposite-Sex") + #NOTE HOW THIS INTERPRETATION LINES UP WITH ABOVE INTERPRETATION OOPS- actually might be good just take it another step further
geom_vline(xintercept = 2015, color = "black", linetype = "dashed") +
scale_x_continuous(breaks = 2011:2019) +
facet_wrap(~ category, labeller = as_labeller(c("frac_to_diff_fed" = "To Other Not/Federally Legalized State", "frac_to_local" = "To Locally Legalized State", "frac_stay" = "To Same State"))) +
theme_apa() #can always go back to theme
from_fed_trends_chart
from_fed_diffs_chart
from_local_diffs_chart
ggsave("/Users/njrich/Desktop/same-sex-migration/outputs/summary_stats/from_local_trends.png", plot = from_local_trends_chart)
ggsave("/Users/njrich/Desktop/same-sex-migration/outputs/summary_stats/from_local_diffs.png", plot = from_local_diffs_chart)
ggsave("/Users/njrich/Desktop/same-sex-migration/outputs/summary_stats/from_fed_trends.png", plot = from_fed_trends_chart)
ggsave("/Users/njrich/Desktop/same-sex-migration/outputs/summary_stats/from_fed_diffs.png", plot = from_fed_diffs_chart)
from_local_diffs_chart
post_migrant_trends_df <- summary_stats %>%
mutate(subgroup = case_when(
in_samesex == 1 & expost_old_legal == 1 ~ "samesex_oldlegal",
in_samesex == 0 & expost_old_legal == 1 ~ "oppositesex_oldlegal",
in_samesex == 1 & expost_old_legal == 0 ~ "samesex_newlegal",
in_samesex == 0 & expost_old_legal == 0 ~ "oppositesex_newlegal"
)) %>%
group_by(year, subgroup) %>%
summarize(frac_migrate = survey_mean(migrant, na.rm = T)) %>%
select(-frac_migrate_se)
post_migrant_diffs_table <- post_migrant_trends_df %>%
pivot_wider(names_from = subgroup, values_from = frac_migrate) %>%
mutate(samesex_diff = samesex_oldlegal - samesex_newlegal) %>%
mutate(oppositesex_diff = oppositesex_oldlegal - oppositesex_newlegal)
ante_migrant_trends_df <- summary_stats %>%
mutate(subgroup = case_when(
in_samesex == 1 & exante_old_legal == 1 ~ "samesex_oldlegal",
in_samesex == 0 & exante_old_legal == 1 ~ "oppositesex_oldlegal",
in_samesex == 1 & exante_old_legal == 0 ~ "samesex_newlegal",
in_samesex == 0 & exante_old_legal == 0 ~ "oppositesex_newlegal"
)) %>%
group_by(year, subgroup) %>%
summarize(frac_migrate = survey_mean(migrant, na.rm = T)) %>%
select(-frac_migrate_se)
ante_migrant_diffs_table <- ante_migrant_trends_df %>%
pivot_wider(names_from = subgroup, values_from = frac_migrate) %>%
mutate(samesex_diff = samesex_oldlegal - samesex_newlegal) %>%
mutate(oppositesex_diff = oppositesex_oldlegal - oppositesex_newlegal)
View(ante_migrant_trends_df)
colnames(clean_df)
post_migrant_trends_df <- summary_stats %>%
mutate(subgroup = case_when(
in_samesex == 1 & expost_old_legal == 1 ~ "samesex_oldlegal",
in_samesex == 0 & expost_old_legal == 1 ~ "oppositesex_oldlegal",
in_samesex == 1 & expost_old_legal == 0 ~ "samesex_newlegal",
in_samesex == 0 & expost_old_legal == 0 ~ "oppositesex_newlegal"
))
ante_migrant_trends_df <- summary_stats %>%
mutate(subgroup = case_when(
in_samesex == 1 & exante_old_legal == 1 ~ "samesex_oldlegal",
in_samesex == 0 & exante_old_legal == 1 ~ "oppositesex_oldlegal",
in_samesex == 1 & exante_old_legal == 0 ~ "samesex_newlegal",
in_samesex == 0 & exante_old_legal == 0 ~ "oppositesex_newlegal"
))
unique(clean_names$sex)
unique(clean_df$sex)
